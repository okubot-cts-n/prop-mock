<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è‹±èªå­¦ç¿’ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ v2.0</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Hiragino Sans', 'Yu Gothic UI', sans-serif;
            line-height: 1.6;
            color: #333;
            background: #f5f5f5;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .screen {
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            margin: 20px 0;
            display: none;
            animation: slideIn 0.5s ease-out;
        }
        
        .screen.active {
            display: block;
        }
        
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .logo {
            color: #2c3e50;
            font-size: 28px;
            font-weight: bold;
            margin-bottom: 10px;
        }
        
        .subtitle {
            color: #666;
            font-size: 16px;
        }
        
        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e9ecef;
            border-radius: 4px;
            overflow: hidden;
            margin: 20px 0;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            transition: width 0.5s ease;
        }
        
        /* è¨ºæ–­ç”»é¢ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        .diagnosis-section {
            margin: 30px 0;
        }
        
        .question {
            font-size: 22px;
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .skill-grid {
            display: grid;
            grid-template-columns: 100px 1fr;
            gap: 20px;
            margin: 30px 0;
        }
        
        .skill-row {
            display: contents;
        }
        
        .skill-label {
            display: flex;
            align-items: center;
            font-weight: bold;
            color: #495057;
        }
        
        .skill-icon {
            margin-right: 8px;
            font-size: 20px;
        }
        
        .difficulty-options {
            display: flex;
            gap: 10px;
            align-items: flex-start;
        }
        
        .difficulty-btn {
            flex: 1;
            padding: 15px;
            border: 2px solid #dee2e6;
            border-radius: 12px;
            background: white;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
            font-size: 14px;
            position: relative;
        }
        
        /* å±•é–‹å¯èƒ½ãªã‚«ãƒ¼ãƒ‰ */
        .expandable-card {
            position: relative;
            transition: all 0.3s ease;
        }
        
        .card-details {
            display: none;
            background: #667eea;
            color: white;
            padding: 15px;
            border-radius: 8px;
            margin-top: 10px;
            font-size: 12px;
            line-height: 1.5;
            animation: slideDown 0.3s ease;
        }
        
        .expandable-card.expanded .card-details {
            display: block;
        }
        
        .expandable-card.expanded {
            align-self: flex-start;
        }
        
        @keyframes slideDown {
            from {
                opacity: 0;
                max-height: 0;
                padding-top: 0;
            }
            to {
                opacity: 1;
                max-height: 200px;
                padding-top: 15px;
            }
        }
        
        /* ä¸»ãªèª²é¡Œéƒ¨åˆ†ã®æ–‡å­—è‰²ã‚’æ”¹å–„ */
        .card-details strong {
            color: #ffffff !important;
            font-weight: 600;
        }
        
        .card-details {
            color: #ffffff !important;
        }
        
        /* ãƒ˜ãƒ«ãƒ—ã‚¢ã‚¤ã‚³ãƒ³ */
        .help-icon {
            position: absolute;
            top: 8px;
            right: 8px;
            width: 20px;
            height: 20px;
            background: #ccc;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            color: white;
            cursor: pointer;
            transition: background 0.3s;
        }
        
        .help-icon:hover {
            background: #667eea;
        }
        
        .difficulty-btn:hover {
            border-color: #667eea;
            background: #f8f9ff;
        }
        
        .difficulty-btn.selected {
            border-color: #667eea !important;
            background: #667eea !important;
            color: white !important;
            transform: scale(1.02);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }
        
        .difficulty-btn.selected:hover {
            background: #5a6fd8 !important;
            cursor: pointer;
        }
        
        .difficulty-btn:not(.selected):hover {
            cursor: pointer;
        }
        
        /* ã‚¹ãƒ†ãƒ¼ã‚¸è¡¨ç¤º */
        .stage-timeline {
            display: flex;
            justify-content: center;
            align-items: center;
            margin: 40px 0;
            position: relative;
        }
        
        .stage-line {
            position: absolute;
            top: 50%;
            left: 10%;
            right: 10%;
            height: 3px;
            background: #dee2e6;
            z-index: 1;
        }
        
        .stage-item {
            background: #dee2e6;
            color: white;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin: 0 20px;
            position: relative;
            z-index: 2;
            transition: all 0.3s;
        }
        
        .stage-item.current {
            background: #667eea;
            transform: scale(1.2);
            box-shadow: 0 0 20px rgba(102, 126, 234, 0.5);
        }
        
        .stage-item.passed {
            background: #28a745;
        }
        
        /* å•é¡Œç‚¹ã¨å¯¾ç­– */
        .issues-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }
        
        .issue-card {
            background: #f8f9fa;
            border-left: 4px solid #dc3545;
            padding: 20px;
            border-radius: 8px;
        }
        
        .issue-title {
            font-weight: bold;
            color: #dc3545;
            margin-bottom: 10px;
        }
        
        .solution-card {
            background: #f8f9fa;
            border-left: 4px solid #28a745;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
        }
        
        .solution-title {
            font-weight: bold;
            color: #28a745;
            margin-bottom: 10px;
        }
        
        /* ã‚µãƒ¼ãƒ“ã‚¹æ¨å¥¨ */
        .services-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }
        
        .service-card {
            background: white;
            border: 2px solid #dee2e6;
            border-radius: 12px;
            padding: 20px;
            transition: all 0.3s;
            cursor: pointer;
        }
        
        .service-card:hover {
            border-color: #667eea;
            transform: translateY(-4px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
        }
        
        .service-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 12px;
        }
        
        .service-logo {
            font-size: 24px;
        }
        
        .service-price {
            color: #667eea;
            font-weight: bold;
            font-size: 14px;
            margin-left: auto;
        }
        
        .service-toeic-level {
            color: #666;
            font-size: 12px;
            margin-top: 8px;
            padding-top: 8px;
            border-top: 1px solid #eee;
        }
        
        .service-name {
            font-weight: bold;
            font-size: 18px;
            margin-bottom: 10px;
            color: #2c3e50;
        }
        
        .service-description {
            color: #666;
            font-size: 14px;
            margin-bottom: 15px;
        }
        
        .service-features {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
        }
        
        .feature-tag {
            background: #e3f2fd;
            color: #1976d2;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 11px;
        }
        
        /* å•†å“è©³ç´°ãƒšãƒ¼ã‚¸ */
        .service-detail {
            background: white;
            border-radius: 12px;
            padding: 30px;
            margin: 20px 0;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        
        .service-header {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .service-logo {
            width: 80px;
            height: 80px;
            background: #f8f9fa;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            margin-right: 20px;
        }
        
        .service-info h2 {
            color: #2c3e50;
            margin-bottom: 5px;
        }
        
        .service-price {
            color: #28a745;
            font-weight: bold;
            font-size: 18px;
        }
        
        .service-details {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin: 30px 0;
        }
        
        .detail-section h3 {
            color: #495057;
            margin-bottom: 15px;
            border-bottom: 2px solid #e9ecef;
            padding-bottom: 8px;
        }
        
        .detail-list {
            list-style: none;
        }
        
        .detail-list li {
            padding: 8px 0;
            border-bottom: 1px solid #f8f9fa;
        }
        
        .detail-list li:before {
            content: "âœ“";
            color: #28a745;
            font-weight: bold;
            margin-right: 10px;
        }
        
        .cta-section {
            text-align: center;
            margin: 30px 0;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 12px;
        }
        
        /* ãƒœã‚¿ãƒ³ */
        .btn {
            padding: 15px 30px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            margin: 10px;
        }
        
        .btn-primary {
            background: #667eea;
            color: white;
        }
        
        .btn-primary:hover {
            background: #5a6fd8;
            transform: translateY(-2px);
        }
        
        .btn-primary:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }
        
        .btn-primary:disabled:hover {
            background: #ccc;
            transform: none;
        }
        
        .btn-secondary {
            background: #6c757d;
            color: white;
        }
        
        .btn-back {
            background: #e9ecef;
            color: #495057;
        }
        
        .btn-container {
            text-align: center;
            margin-top: 40px;
        }
        
        .navigation-tabs {
            display: flex;
            justify-content: center;
            margin-bottom: 20px;
        }
        
        .nav-tab {
            padding: 10px 20px;
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .nav-tab:first-child {
            border-radius: 8px 0 0 8px;
        }
        
        .nav-tab:last-child {
            border-radius: 0 8px 8px 0;
        }
        
        .nav-tab.active {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }
        
        /* TOEICé¸æŠãƒœã‚¿ãƒ³ */
        .toeic-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 30px 0;
        }
        
        .toeic-btn {
            background: white;
            border: 2px solid #dee2e6;
            border-radius: 12px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
        }
        
        .toeic-btn:hover {
            border-color: #667eea;
            background: #f8f9ff;
        }
        
        .toeic-btn.selected {
            border-color: #667eea;
            background: #667eea;
            color: white;
        }
        
        .toeic-score {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .toeic-level {
            font-size: 14px;
            margin-bottom: 8px;
            opacity: 0.8;
        }
        
        .toeic-description {
            font-size: 12px;
            opacity: 0.7;
        }

        /* èª²é¡Œãƒ»å¯¾ç­–ãƒ»ã‚¢ãƒ—ãƒ­ãƒ¼ãƒã®ã‚°ãƒªãƒƒãƒ‰ */
        .challenge-solution-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }
        
        .challenge-solution-card {
            background: white;
            border: 2px solid #e9ecef;
            border-radius: 15px;
            padding: 25px;
            transition: all 0.3s;
            cursor: pointer;
        }
        
        .challenge-solution-card:hover {
            border-color: #667eea;
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
        }
        
        .challenge-solution-card.selected {
            border-color: #667eea;
            background: #f8f9ff;
        }
        
        .challenge-header {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .challenge-icon {
            font-size: 24px;
            margin-right: 10px;
        }
        
        .challenge-title {
            font-size: 18px;
            font-weight: bold;
            color: #2c3e50;
        }
        
        .challenge-description {
            color: #666;
            font-size: 14px;
            margin-bottom: 20px;
            line-height: 1.5;
        }
        
        .solution-section {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
        }
        
        .solution-section-title {
            font-weight: bold;
            color: #495057;
            margin-bottom: 8px;
            font-size: 14px;
        }
        
        .solution-content {
            color: #666;
            font-size: 13px;
            line-height: 1.4;
        }
        
        .approach-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            margin-top: 10px;
        }
        
        .approach-tag {
            background: #e3f2fd;
            color: #1976d2;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- ç”»é¢1: é–‹å§‹ç”»é¢ -->
        <div class="screen active" id="start-screen">
            <div class="header">
                <div class="logo">ğŸ¯ è‹±èªå­¦ç¿’ãƒŠãƒ“</div>
                <div class="subtitle">ã‚ãªãŸã«æœ€é©ãªè‹±èªå­¦ç¿’ã‚µãƒ¼ãƒ“ã‚¹ã‚’è¦‹ã¤ã‘ã¾ã—ã‚‡ã†</div>
            </div>
            
            <div style="text-align: center; margin: 50px 0;">
                <h2>3ã¤ã®è³ªå•ã§æœ€é©ãªã‚³ãƒ¼ã‚¹ã‚’è¨ºæ–­</h2>
                <p style="color: #666; margin: 20px 0;">ç¾åœ¨ã®è‹±èªãƒ¬ãƒ™ãƒ«ã¨å­¦ç¿’ç›®æ¨™ã‹ã‚‰ã€ã‚ãªãŸã«ã´ã£ãŸã‚Šã®ã‚µãƒ¼ãƒ“ã‚¹ã‚’ã”ææ¡ˆã—ã¾ã™</p>
                <div style="margin: 40px 0;">
                    <div style="font-size: 48px; margin-bottom: 20px;">ğŸ“š</div>
                    <div style="color: #666;">è¨ºæ–­æ™‚é–“ï¼šç´„2åˆ†</div>
                </div>
            </div>
            
            <div class="btn-container">
                <button class="btn btn-primary" onclick="nextScreen('diagnosis-screen')">è¨ºæ–­ã‚’é–‹å§‹ã™ã‚‹</button>
            </div>
        </div>
        
        <!-- ç”»é¢2: è¨ºæ–­ç”»é¢ -->
        <div class="screen" id="diagnosis-screen">
            <div class="header">
                <div class="logo">ãƒ¬ãƒ™ãƒ«è¨ºæ–­</div>
                <div class="progress-bar">
                    <div class="progress-fill" style="width: 25%"></div>
                </div>
            </div>
            
            <div class="diagnosis-section">
                <div class="question">ã¾ãšã€ã‚ãªãŸã®ç¾åœ¨ã®TOEICãƒ¬ãƒ™ãƒ«ã‚’æ•™ãˆã¦ãã ã•ã„</div>
                
                <div class="toeic-options">
                    <div class="toeic-btn" onclick="selectTOEIC(this, 'basic')">
                        <div class="toeic-score">300-600ç‚¹</div>
                        <div class="toeic-level">åŸºç¤ãƒ¬ãƒ™ãƒ«</div>
                        <div class="toeic-description">åŸºæœ¬çš„ãªæ–‡æ³•ã‚„èªå½™ã‚’å­¦ç¿’ä¸­</div>
                    </div>
                    <div class="toeic-btn" onclick="selectTOEIC(this, 'intermediate')">
                        <div class="toeic-score">600-750ç‚¹</div>
                        <div class="toeic-level">ä¸­ç´šãƒ¬ãƒ™ãƒ«</div>
                        <div class="toeic-description">æ—¥å¸¸çš„ãªè‹±èªã¯ç†è§£ã§ãã‚‹</div>
                    </div>
                    <div class="toeic-btn" onclick="selectTOEIC(this, 'advanced')">
                        <div class="toeic-score">750ç‚¹ä»¥ä¸Š</div>
                        <div class="toeic-level">ä¸Šç´šãƒ¬ãƒ™ãƒ«</div>
                        <div class="toeic-description">ãƒ“ã‚¸ãƒã‚¹è‹±èªã‚‚ç†è§£ã§ãã‚‹</div>
                    </div>
                    <div class="toeic-btn" onclick="selectTOEIC(this, 'unknown')">
                        <div class="toeic-score">æœªå—é¨“</div>
                        <div class="toeic-level">ãƒ¬ãƒ™ãƒ«ä¸æ˜</div>
                        <div class="toeic-description">TOEICã‚’å—ã‘ãŸã“ã¨ãŒãªã„</div>
                    </div>
                </div>
            </div>
            
            <div class="btn-container">
                <button class="btn btn-back" onclick="prevScreen('start-screen')">æˆ»ã‚‹</button>
                <button class="btn btn-primary" id="toeic-next-btn" onclick="nextScreen('skills-diagnosis')" disabled>æ¬¡ã¸</button>
            </div>
        </div>
        
        <!-- ç”»é¢2.5: ã‚¹ã‚­ãƒ«è¨ºæ–­ç”»é¢ -->
        <div class="screen" id="skills-diagnosis">
            <div class="header">
                <div class="logo">ã‚¹ã‚­ãƒ«è¨ºæ–­</div>
                <div class="progress-bar">
                    <div class="progress-fill" style="width: 50%"></div>
                </div>
            </div>
            
            <div class="diagnosis-section">
                <div class="question">ç¾åœ¨ã®è‹±èªã‚¹ã‚­ãƒ«ã«ã¤ã„ã¦æ•™ãˆã¦ãã ã•ã„</div>
                
                <div class="skill-grid">
                    <div class="skill-label">
                        <span class="skill-icon">ğŸ§</span> éŸ³å£°
                    </div>
                    <div class="difficulty-options">
                        <div class="difficulty-btn expandable-card" onclick="selectDifficulty(this, 'sound', 'basic')" data-skill="sound" data-level="basic">
                            <div class="help-icon" onclick="event.stopPropagation(); toggleCardDetails(this.parentElement)" title="è©³ç´°ã‚’è¡¨ç¤º">i</div>
                            åŸºæœ¬çš„ãªãƒ«ãƒ¼ãƒ«ãŒ<br>ã‚ã‹ã‚‰ãªã„
                            <div class="card-details">
                                <strong>ğŸ¯ ä¸»ãªèª²é¡Œï¼š</strong><br>
                                ç™ºéŸ³è¨˜å·ãŒèª­ã‚ãªã„ã€å­éŸ³ãƒ»æ¯éŸ³ã®åŒºåˆ¥ãŒã¤ã‹ãªã„ã€ã‚¢ã‚¯ã‚»ãƒ³ãƒˆã®ä½ç½®ãŒã‚ã‹ã‚‰ãªã„
                                <br><br>
                                <strong>ğŸ“ å¯¾ç­–ã‚¢ãƒ—ãƒ­ãƒ¼ãƒï¼š</strong><br>
                                ãƒ•ã‚©ãƒ‹ãƒƒã‚¯ã‚¹å­¦ç¿’ã€ç™ºéŸ³è¨˜å·å­¦ç¿’ã€éŸ³å£°èªè­˜ç·´ç¿’
                        </div>
                        </div>
                        <div class="difficulty-btn expandable-card" onclick="selectDifficulty(this, 'sound', 'intermediate')" data-skill="sound" data-level="intermediate">
                            <div class="help-icon" onclick="event.stopPropagation(); toggleCardDetails(this.parentElement)" title="è©³ç´°ã‚’è¡¨ç¤º">i</div>
                            éŸ³ãŒèãåˆ†ã‘ã‚‰ã‚Œãªã„<br>éŸ³ãŒå›ã‚‰ãªã„
                            <div class="card-details">
                                <strong>ğŸ¯ ä¸»ãªèª²é¡Œï¼š</strong><br>
                                L/Rã®åŒºåˆ¥ãŒã§ããªã„ã€THéŸ³ãŒç™ºéŸ³ã§ããªã„ã€å˜èªãƒ¬ãƒ™ãƒ«ã§ã®ç™ºéŸ³ãŒä¸æ­£ç¢º
                                <br><br>
                                <strong>ğŸ“ å¯¾ç­–ã‚¢ãƒ—ãƒ­ãƒ¼ãƒï¼š</strong><br>
                                éŸ³å£°èªè­˜è¨“ç·´ã€ç™ºéŸ³çŸ¯æ­£ã€ãƒªã‚¹ãƒ‹ãƒ³ã‚°å¼·åŒ–
                        </div>
                        </div>
                        <div class="difficulty-btn expandable-card" onclick="selectDifficulty(this, 'sound', 'advanced')" data-skill="sound" data-level="advanced">
                            <div class="help-icon" onclick="event.stopPropagation(); toggleCardDetails(this.parentElement)" title="è©³ç´°ã‚’è¡¨ç¤º">i</div>
                            ã‚¹ãƒ”ãƒ¼ãƒ‰ã«ã¤ã„ã¦ã„ã‘ãªã„<br>é•·ããªã‚‹ã¨ä¿æŒã§ããªã„
                            <div class="card-details">
                                <strong>ğŸ¯ ä¸»ãªèª²é¡Œï¼š</strong><br>
                                ãƒã‚¤ãƒ†ã‚£ãƒ–ã®ä¼šè©±ã«ã¤ã„ã¦ã„ã‘ãªã„ã€é•·ã„èª¬æ˜ã‚’è¦šãˆã¦ã„ã‚‰ã‚Œãªã„ã€éŸ³å£°æƒ…å ±ã®å‡¦ç†ãŒè¿½ã„ã¤ã‹ãªã„
                                <br><br>
                                <strong>ğŸ“ å¯¾ç­–ã‚¢ãƒ—ãƒ­ãƒ¼ãƒï¼š</strong><br>
                                é«˜é€Ÿãƒªã‚¹ãƒ‹ãƒ³ã‚°è¨“ç·´ã€éŸ³å£°è¨˜æ†¶ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ã€å®Ÿè·µçš„ä¼šè©±ç·´ç¿’
                            </div>
                        </div>
                    </div>
                    
                    <div class="skill-label">
                        <span class="skill-icon">ğŸ“</span> æ–‡ç« 
                    </div>
                    <div class="difficulty-options">
                        <div class="difficulty-btn expandable-card" onclick="selectDifficulty(this, 'text', 'basic')" data-skill="text" data-level="basic">
                            <div class="help-icon" onclick="event.stopPropagation(); toggleCardDetails(this.parentElement)" title="è©³ç´°ã‚’è¡¨ç¤º">i</div>
                            åŸºæœ¬çš„ãªæ–‡ã®ãƒ«ãƒ¼ãƒ«<br>ï¼ˆæ–‡æ³•ï¼‰ãŒã‚ã‹ã‚‰ãªã„
                            <div class="card-details">
                                <strong>ğŸ¯ ä¸»ãªèª²é¡Œï¼š</strong><br>
                                æ™‚åˆ¶ã®æ¦‚å¿µãŒã‚ã‹ã‚‰ãªã„ã€èªé †ãŒç†è§£ã§ããªã„ã€å“è©ã®åŒºåˆ¥ãŒã§ããªã„
                                <br><br>
                                <strong>ğŸ“ å¯¾ç­–ã‚¢ãƒ—ãƒ­ãƒ¼ãƒï¼š</strong><br>
                                åŸºç¤æ–‡æ³•å­¦ç¿’ã€ãƒ‘ã‚¿ãƒ¼ãƒ³ç·´ç¿’ã€æ§‹æ–‡ç†è§£ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°
                        </div>
                        </div>
                        <div class="difficulty-btn expandable-card" onclick="selectDifficulty(this, 'text', 'intermediate')" data-skill="text" data-level="intermediate">
                            <div class="help-icon" onclick="event.stopPropagation(); toggleCardDetails(this.parentElement)" title="è©³ç´°ã‚’è¡¨ç¤º">i</div>
                            æ–‡ç« ã§ç†è§£ã§ããªã„<br>æ–‡ã‚’çµ„ã¿ç«‹ã¦ã‚‰ã‚Œãªã„
                            <div class="card-details">
                                <strong>ğŸ¯ ä¸»ãªèª²é¡Œï¼š</strong><br>
                                é•·ã„æ–‡ãŒèª­ã‚ãªã„ã€æ­£ã—ã„æ–‡ãŒä½œã‚Œãªã„ã€æ–‡è„ˆãŒç†è§£ã§ããªã„
                                <br><br>
                                <strong>ğŸ“ å¯¾ç­–ã‚¢ãƒ—ãƒ­ãƒ¼ãƒï¼š</strong><br>
                                èª­è§£ç·´ç¿’ã€è‹±ä½œæ–‡è¨“ç·´ã€æ–‡æ§‹é€ åˆ†æ
                        </div>
                        </div>
                        <div class="difficulty-btn expandable-card" onclick="selectDifficulty(this, 'text', 'advanced')" data-skill="text" data-level="advanced">
                            <div class="help-icon" onclick="event.stopPropagation(); toggleCardDetails(this.parentElement)" title="è©³ç´°ã‚’è¡¨ç¤º">i</div>
                            æƒ…å ±é‡ãŒå¤šããªã‚‹ã¨<br>ç†è§£ã§ããªã„/è©±ã›ãªã„
                            <div class="card-details">
                                <strong>ğŸ¯ ä¸»ãªèª²é¡Œï¼š</strong><br>
                                é•·æ–‡èª­è§£ãŒå›°é›£ã€è¤‡é›‘ãªè­°è«–ãŒã§ããªã„ã€æƒ…å ±æ•´ç†ãŒã§ããªã„
                                <br><br>
                                <strong>ğŸ“ å¯¾ç­–ã‚¢ãƒ—ãƒ­ãƒ¼ãƒï¼š</strong><br>
                                æƒ…å ±å‡¦ç†èƒ½åŠ›å‘ä¸Šã€è«–ç†çš„æ€è€ƒè¨“ç·´ã€é«˜åº¦ãªèª­è§£ãƒ»è¡¨ç¾ç·´ç¿’
                            </div>
                        </div>
                    </div>
                    
                    <div class="skill-label">
                        <span class="skill-icon">ğŸ“–</span> èªå½™
                    </div>
                    <div class="difficulty-options">
                        <div class="difficulty-btn expandable-card" onclick="selectDifficulty(this, 'vocabulary', 'basic')" data-skill="vocabulary" data-level="basic">
                            <div class="help-icon" onclick="event.stopPropagation(); toggleCardDetails(this.parentElement)" title="è©³ç´°ã‚’è¡¨ç¤º">i</div>
                            åŸºæœ¬çš„ãªå˜èªãŒ<br>ã‚ã‹ã‚‰ãªã„
                            <div class="card-details">
                                <strong>ğŸ¯ ä¸»ãªèª²é¡Œï¼š</strong><br>
                                é«˜é »å‡ºå˜èªãŒã‚ã‹ã‚‰ãªã„ã€åŸºæœ¬çš„ãªå‹•è©ãƒ»åè©ãŒä¸æ˜ã€å˜èªã®æ„å‘³ãŒæ›–æ˜§
                                <br><br>
                                <strong>ğŸ“ å¯¾ç­–ã‚¢ãƒ—ãƒ­ãƒ¼ãƒï¼š</strong><br>
                                åŸºæœ¬èªå½™å­¦ç¿’ã€é »å‡ºå˜èªæš—è¨˜ã€èªå½™å®šç€ç·´ç¿’
                        </div>
                        </div>
                        <div class="difficulty-btn expandable-card" onclick="selectDifficulty(this, 'vocabulary', 'intermediate')" data-skill="vocabulary" data-level="intermediate">
                            <div class="help-icon" onclick="event.stopPropagation(); toggleCardDetails(this.parentElement)" title="è©³ç´°ã‚’è¡¨ç¤º">i</div>
                            ã¨ã£ã•ã«ç°¡å˜ãª<br>å˜èªãŒå‡ºã¦ã“ãªã„
                            <div class="card-details">
                                <strong>ğŸ¯ ä¸»ãªèª²é¡Œï¼š</strong><br>
                                ä¼šè©±ã§å˜èªãŒå‡ºã¦ã“ãªã„ã€ç†è§£ã¯ã§ãã‚‹ãŒä½¿ãˆãªã„ã€èªå½™ã®æ´»ç”¨ãŒã§ããªã„
                                <br><br>
                                <strong>ğŸ“ å¯¾ç­–ã‚¢ãƒ—ãƒ­ãƒ¼ãƒï¼š</strong><br>
                                èªå½™ç¬ç™ºåŠ›è¨“ç·´ã€å®Ÿè·µçš„èªå½™ç·´ç¿’ã€èªå½™æ´»ç”¨ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°
                        </div>
                        </div>
                        <div class="difficulty-btn expandable-card" onclick="selectDifficulty(this, 'vocabulary', 'advanced')" data-skill="vocabulary" data-level="advanced">
                            <div class="help-icon" onclick="event.stopPropagation(); toggleCardDetails(this.parentElement)" title="è©³ç´°ã‚’è¡¨ç¤º">i</div>
                            æ–‡è„ˆã«å¿œã˜ãŸè¡¨ç¾ã®<br>ä½¿ã„åˆ†ã‘ãŒã§ããªã„
                            <div class="card-details">
                                <strong>ğŸ¯ ä¸»ãªèª²é¡Œï¼š</strong><br>
                                ãƒ•ã‚©ãƒ¼ãƒãƒ«ãƒ»ã‚«ã‚¸ãƒ¥ã‚¢ãƒ«ã®åŒºåˆ¥ãŒã§ããªã„ã€åŒç¾©èªã®ä½¿ã„åˆ†ã‘ãŒã§ããªã„ã€ãƒ‹ãƒ¥ã‚¢ãƒ³ã‚¹ãŒä¼ã‚ã‚‰ãªã„
                                <br><br>
                                <strong>ğŸ“ å¯¾ç­–ã‚¢ãƒ—ãƒ­ãƒ¼ãƒï¼š</strong><br>
                                æ–‡è„ˆåˆ¥èªå½™å­¦ç¿’ã€è¡¨ç¾åŠ›å¼·åŒ–è¨“ç·´ã€é«˜åº¦ãªèªå½™é‹ç”¨ç·´ç¿’
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="btn-container">
                <button class="btn btn-back" onclick="prevScreen('diagnosis-screen')">æˆ»ã‚‹</button>
                <button class="btn btn-primary" id="skills-next-btn" onclick="nextScreen('level-result')" disabled>æ¬¡ã¸</button>
            </div>
        </div>
        
        <!-- ç”»é¢3: ãƒ¬ãƒ™ãƒ«åˆ¤å®šçµæœ -->
        <div class="screen" id="level-result">
            <div class="header">
                <div class="logo">ã‚ãªãŸã®ãƒ¬ãƒ™ãƒ«è¨ºæ–­çµæœ</div>
                <div class="progress-bar">
                    <div class="progress-fill" style="width: 66%"></div>
                </div>
            </div>
            
            <div class="stage-timeline" id="stage-timeline">
                <div class="stage-line"></div>
                <div class="stage-item" data-level="A1">A1</div>
                <div class="stage-item" data-level="A2">A2</div>
                <div class="stage-item" data-level="B1">B1</div>
                <div class="stage-item" data-level="B2">B2</div>
                <div class="stage-item" data-level="C1">C1</div>
                <div class="stage-item" data-level="C2">C2</div>
            </div>
            
            <div style="text-align: center; margin: 30px 0;">
                <h2 style="color: #667eea;">ã‚ãªãŸã®ç¾åœ¨ãƒ¬ãƒ™ãƒ«ï¼š<span id="user-level">A2</span></h2>
                <p style="color: #666;" id="level-description">åŸºç¤èªå½™ãŒã‚ã‚‹ç¨‹åº¦ç†è§£ã§ãã‚‹ãƒ¬ãƒ™ãƒ«ï¼ˆTOEIC 500-600ï¼‰</p>
            </div>
            
            <div style="margin: 20px 0;">
                <h3 style="color: #333; margin-bottom: 15px;">ğŸ“‹ ã‚ãªãŸã®ä¸»ãªèª²é¡Œ</h3>
                <ul id="user-issues" style="background: #f8f9ff; padding: 20px; border-radius: 8px; color: #333;">
                    <!-- èª²é¡Œãƒªã‚¹ãƒˆãŒå‹•çš„ã«è¡¨ç¤ºã•ã‚Œã‚‹ -->
                    </ul>
            </div>
            
            <div class="challenge-solution-grid" id="challenge-solution-grid">
                <!-- èª²é¡Œãƒ»å¯¾ç­–ãƒ»ã‚¢ãƒ—ãƒ­ãƒ¼ãƒãŒã‚»ãƒƒãƒˆã§è¡¨ç¤ºã•ã‚Œã‚‹ -->
            </div>
            
            <div class="btn-container">
                <button class="btn btn-back" onclick="prevScreen('diagnosis-screen')">æˆ»ã‚‹</button>
                <button class="btn btn-primary" onclick="showServices()">ã‚µãƒ¼ãƒ“ã‚¹ã‚’è¦‹ã‚‹</button>
            </div>
        </div>
        
        <!-- ç”»é¢4: ã‚µãƒ¼ãƒ“ã‚¹æ¨å¥¨ -->
        <div class="screen" id="service-recommendation">
            <div class="header">
                <div class="logo">ã‚ãªãŸã«ãŠã™ã™ã‚ã®ã‚µãƒ¼ãƒ“ã‚¹</div>
                <div class="progress-bar">
                    <div class="progress-fill" style="width: 100%"></div>
                </div>
            </div>
            
            <div style="text-align: center; margin: 30px 0;">
                <h2 id="recommendation-title">å­¦ç¿’ãƒ—ãƒ©ãƒ³</h2>
                <p style="color: #666;" id="recommendation-subtitle">ã‚ãªãŸã®ãƒ¬ãƒ™ãƒ«ã«åˆã‚ã›ãŸæœ€é©ãªã‚µãƒ¼ãƒ“ã‚¹ã‚’ã”ææ¡ˆ</p>
            </div>
            
            <div class="services-grid" id="services-container">
                <!-- ã‚µãƒ¼ãƒ“ã‚¹ã‚«ãƒ¼ãƒ‰ã¯å‹•çš„ã«ç”Ÿæˆ -->
            </div>
            
            <div class="btn-container">
                <button class="btn btn-back" onclick="prevScreen('level-result')">æˆ»ã‚‹</button>
                <button class="btn btn-primary" onclick="nextScreen('start-screen')">æœ€åˆã«æˆ»ã‚‹</button>
            </div>
        </div>
        
        <!-- å•†å“è©³ç´°ãƒšãƒ¼ã‚¸ -->
        <div class="screen" id="service-detail">
            <div class="header">
                <div class="logo">ã‚µãƒ¼ãƒ“ã‚¹è©³ç´°</div>
            </div>
            
            <div class="service-detail" id="service-detail-content">
                <!-- è©³ç´°å†…å®¹ã¯å‹•çš„ã«ç”Ÿæˆ -->
            </div>
            
            <div class="btn-container">
                <button class="btn btn-back" onclick="prevScreen('service-recommendation')">æˆ»ã‚‹</button>
                <button class="btn btn-primary" onclick="visitService()">å…¬å¼ã‚µã‚¤ãƒˆã¸</button>
            </div>
        </div>
    </div>
    
    <script>
        // ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®é¸æŠã‚’ä¿å­˜
        let userSelections = {
            toeic: null
        };

        // æ–°ã—ã„ãƒ‡ãƒ¼ã‚¿æ§‹é€ ã‹ã‚‰é¸æŠã•ã‚ŒãŸã‚¹ã‚­ãƒ«ã‚’å–å¾—ã™ã‚‹ãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•°
        function getSelectedSkills() {
            const skills = {sound: [], text: [], vocabulary: []};
            
            Object.keys(userSelections).forEach(key => {
                if (key.includes('_') && userSelections[key] && userSelections[key].skill) {
                    const skillData = userSelections[key];
                    skills[skillData.skill].push(skillData.level);
                }
            });
            
            return skills;
        }

        // ç‰¹å®šã®ã‚¹ã‚­ãƒ«ã§é¸æŠã•ã‚Œã¦ã„ã‚‹ãƒ¬ãƒ™ãƒ«ã‚’å–å¾—
        function getSkillLevels(skillName) {
            const skills = getSelectedSkills();
            return skills[skillName] || [];
        }

        // ã‚¹ã‚­ãƒ«ãŒé¸æŠã•ã‚Œã¦ã„ã‚‹ã‹ãƒã‚§ãƒƒã‚¯
        function hasSkillSelection(skillName, level = null) {
            const levels = getSkillLevels(skillName);
            if (level) {
                return levels.includes(level);
            }
            return levels.length > 0;
        }
        
        // ç”»é¢é·ç§»é–¢æ•°
        function nextScreen(screenId) {
            document.querySelectorAll('.screen').forEach(screen => {
                screen.classList.remove('active');
            });
            document.getElementById(screenId).classList.add('active');
            
            // ã‚¹ã‚­ãƒ«è¨ºæ–­ç”»é¢ã‹ã‚‰æ¬¡ã«é€²ã‚€å ´åˆã®å‡¦ç†
            if (screenId === 'level-result') {
                updateChallengeSolutionCards();
                updateUserIssues();
            }
        }

        // å‰ã®ç”»é¢ã«æˆ»ã‚‹é–¢æ•°
        function prevScreen(screenId) {
            document.querySelectorAll('.screen').forEach(screen => {
                screen.classList.remove('active');
            });
            document.getElementById(screenId).classList.add('active');
        }

        // ã‚µãƒ¼ãƒ“ã‚¹æ¨è–¦ç”»é¢ã¸ã®é·ç§»
        function showServices() {
            nextScreen('service-recommendation');
            displayServices();
            updateRecommendationTitle();
        }

        // å¯¾ç­–ã‚¿ãƒ–ã®è¡¨ç¤º
        function showSolution(type) {
            nextScreen('solution');
            showSolutionTabs();
        }

        // ã‚µãƒ¼ãƒ“ã‚¹è¡¨ç¤ºé–¢æ•°
        function displayServices() {
            console.log('ğŸ¯ displayServices called');
            console.log('Current userSelections:', userSelections);
            
            const selectedServices = getFilteredServices();
            console.log('ğŸ” Filtered services:', selectedServices);
            console.log('ğŸ“Š Service count:', selectedServices.length);
            
            updateRecommendationTitle();
            const container = document.getElementById('services-container');
            
            if (!container) {
                console.error('âŒ services-container element not found!');
                return;
            }
            
            container.innerHTML = '';

            if (selectedServices.length === 0) {
                console.log('âš ï¸ No services found, showing default message');
                container.innerHTML = '<div style="text-align: center; color: #666; padding: 40px;">èª²é¡Œã‚’é¸æŠã—ã¦ã‹ã‚‰ã‚µãƒ¼ãƒ“ã‚¹ã‚’è¡¨ç¤ºã—ã¾ã™</div>';
                return;
            }
            
            console.log('âœ… Displaying services:', selectedServices.map(s => s.name));

            selectedServices.forEach((service, index) => {
                const card = document.createElement('div');
                card.className = 'service-card';
                card.onclick = () => showServiceDetail(service);

                const features = [
                    ...service.tags.specialties,
                    service.tags.learningStyle === 'self-study' ? 'è‡ªä¸»å­¦ç¿’' :
                    service.tags.learningStyle === 'instructor-led' ? 'è¬›å¸«ä»˜ã' :
                    service.tags.learningStyle === 'ai-learning' ? 'AIå­¦ç¿’' :
                    service.tags.learningStyle === 'coaching' ? 'ã‚³ãƒ¼ãƒãƒ³ã‚°' : 'å­¦ç¿’ã‚µãƒãƒ¼ãƒˆ'
                ];

                card.innerHTML = `
                    <div class="service-header">
                        <span class="service-logo">${service.logo}</span>
                        <div class="service-name">${service.name}</div>
                        <div class="service-price">${service.price}</div>
                    </div>
                    <div class="service-features">
                        ${features.slice(0, 3).map(feature => `<span class="feature-tag">${feature}</span>`).join('')}
                    </div>
                    <div class="service-toeic-level">
                        å¯¾å¿œãƒ¬ãƒ™ãƒ«: ${service.tags.toeicLevels.join(', ')}
                    </div>
                `;

                container.appendChild(card);
            });
        }

        // ã‚¹ã‚­ãƒ«è¨ºæ–­ã®é¸æŠæ©Ÿèƒ½
        function selectDifficulty(element, skill, level) {
            console.log('ğŸ”¥ selectDifficulty called:', skill, level);
            console.log('Element classes before:', element.className);
            console.log('Current userSelections before:', userSelections);
            
            // æ—¢ã«é¸æŠã•ã‚Œã¦ã„ã‚‹å ´åˆã¯é¸æŠã‚’è§£é™¤
            if (element.classList.contains('selected')) {
                console.log('ğŸ”´ Element is selected, deselecting...');
                element.classList.remove('selected');
                delete userSelections[skill + '_' + level];
                console.log('ğŸ”´ Deselected:', skill, level);
                
                // è©³ç´°ãŒå±•é–‹ã•ã‚Œã¦ã„ã‚‹å ´åˆã¯é–‰ã˜ã‚‹
                const cardDetails = element.querySelector('.card-details');
                if (cardDetails && cardDetails.style.display !== 'none') {
                    cardDetails.style.display = 'none';
                    element.classList.remove('expanded');
                }
            } else {
                console.log('ğŸ”µ Element is not selected, selecting...');
                
                // ç¸¦æ¨ªé–¢ä¿‚ãªãè‡ªç”±é¸æŠ - ä»–ã®é¸æŠã‚’è§£é™¤ã—ãªã„
                console.log('ğŸ” Free selection mode - no restrictions');
                
                // æ–°ã—ã„é¸æŠã‚’è¿½åŠ 
                element.classList.add('selected');
                userSelections[skill + '_' + level] = {skill: skill, level: level};
                console.log('ğŸ”µ Selected:', skill, level);
                
                // è©³ç´°ã‚’å±•é–‹
                const cardDetails = element.querySelector('.card-details');
                if (cardDetails) {
                    cardDetails.style.display = 'block';
                    element.classList.add('expanded');
                }
            }
            
            console.log('Element classes after:', element.className);
            console.log('Current userSelections after:', userSelections);
            
            // å…¨ä½“ã®é¸æŠçŠ¶æ³ã‚’ç¢ºèª
            const allSelected = document.querySelectorAll('.difficulty-btn.selected');
            console.log('ğŸ“Š Total selected buttons:', allSelected.length);
            allSelected.forEach((btn, i) => {
                console.log(`  ${i+1}. ${btn.dataset.skill} - ${btn.dataset.level}`);
            });
            
            // æ¬¡ã¸ãƒœã‚¿ãƒ³ã®æœ‰åŠ¹/ç„¡åŠ¹ã‚’æ›´æ–°
            updateSkillsNextButton();
        }

        // ã‚«ãƒ¼ãƒ‰è©³ç´°ã®å±•é–‹ãƒ»æŠ˜ã‚ŠãŸãŸã¿æ©Ÿèƒ½
        function toggleCardDetails(element) {
            const card = element.closest ? element.closest('.expandable-card') : element;
            const details = card.querySelector('.card-details');
            
            if (details) {
                if (details.style.display === 'none' || details.style.display === '') {
                    details.style.display = 'block';
                    card.classList.add('expanded');
                } else {
                    details.style.display = 'none';
                    card.classList.remove('expanded');
                }
            }
        }

        // TOEICé¸æŠæ©Ÿèƒ½
        function selectTOEIC(element, level) {
            // æ—¢ã«é¸æŠã•ã‚Œã¦ã„ã‚‹å ´åˆã¯é¸æŠã‚’è§£é™¤
            if (element.classList.contains('selected')) {
                element.classList.remove('selected');
                userSelections.toeic = null;
            } else {
                // ä»–ã®ãƒœã‚¿ãƒ³ã®é¸æŠã‚’è§£é™¤
                const siblings = element.parentElement.children;
                for (let sibling of siblings) {
                    sibling.classList.remove('selected');
                }
                
                // æ–°ã—ã„é¸æŠã‚’è¿½åŠ 
                element.classList.add('selected');
                userSelections.toeic = level;
            }
            
            // æ¬¡ã¸ãƒœã‚¿ãƒ³ã®æœ‰åŠ¹/ç„¡åŠ¹ã‚’æ›´æ–°
            updateTOEICNextButton();
        }
        
        function updateTOEICNextButton() {
            const nextBtn = document.getElementById('toeic-next-btn');
            
            if (userSelections.toeic) {
                nextBtn.disabled = false;
                nextBtn.style.opacity = '1';
                nextBtn.style.cursor = 'pointer';
            } else {
                nextBtn.disabled = true;
                nextBtn.style.opacity = '0.5';
                nextBtn.style.cursor = 'not-allowed';
            }
        }
        
        // èª²é¡Œè©³ç´°ãƒ‡ãƒ¼ã‚¿
        const challengeDetails = {
            sound: {
                basic: {
                    title: "éŸ³å£° - åŸºæœ¬çš„ãªãƒ«ãƒ¼ãƒ«ãŒã‚ã‹ã‚‰ãªã„",
                    description: "è‹±èªã®éŸ³ã®ãƒ«ãƒ¼ãƒ«ï¼ˆç™ºéŸ³è¨˜å·ã€éŸ³ã®å¤‰åŒ–ã€ãƒªã‚ºãƒ ãªã©ï¼‰ã®åŸºç¤çŸ¥è­˜ãŒä¸è¶³ã—ã¦ã„ã‚‹çŠ¶æ…‹ã§ã™ã€‚",
                    examples: [
                        "ç™ºéŸ³è¨˜å·ãŒèª­ã‚ãªã„",
                        "å­éŸ³ã¨æ¯éŸ³ã®åŒºåˆ¥ãŒã§ããªã„",
                        "å˜èªã®ã‚¢ã‚¯ã‚»ãƒ³ãƒˆãŒã‚ã‹ã‚‰ãªã„",
                        "ãƒªã‚¨ã‚¾ãƒ³ï¼ˆéŸ³ã®é€£çµï¼‰ãŒç†è§£ã§ããªã„",
                        "å¼·å‹¢ã¨ãƒªã‚ºãƒ ãŒã¤ã‹ã‚ãªã„"
                    ]
                },
                intermediate: {
                    title: "éŸ³å£° - éŸ³ãŒèãåˆ†ã‘ã‚‰ã‚Œãªã„ãƒ»éŸ³ãŒå›ã‚‰ãªã„",
                    description: "åŸºæœ¬çš„ãªéŸ³ã®ãƒ«ãƒ¼ãƒ«ã¯ç†è§£ã—ã¦ã„ã‚‹ãŒã€å®Ÿéš›ã®èãå–ã‚Šã‚„ç™ºè©±ã§å›°é›£ã‚’æ„Ÿã˜ã¦ã„ã‚‹çŠ¶æ…‹ã§ã™ã€‚",
                    examples: [
                        "Lã¨Rã®åŒºåˆ¥ãŒã§ããªã„",
                        "THã®éŸ³ãŒå‡ºã›ãªã„",
                        "æ—©å£ã«ãªã‚‹ã¨èãå–ã‚Œãªã„",
                        "è‡ªåˆ†ã§ç™ºéŸ³ã—ã‚ˆã†ã¨ã™ã‚‹ã¨èˆŒãŒå›ã‚‰ãªã„",
                        "ãƒã‚¤ãƒ†ã‚£ãƒ–ã®ç™ºéŸ³ã¨è‡ªåˆ†ã®ç™ºéŸ³ãŒé•ã†"
                    ]
                },
                advanced: {
                    title: "éŸ³å£° - ã‚¹ãƒ”ãƒ¼ãƒ‰ã«ã¤ã„ã¦ã„ã‘ãªã„ãƒ»é•·ããªã‚‹ã¨ä¿æŒã§ããªã„",
                    description: "å€‹ã€…ã®éŸ³ã¯ç†è§£ã§ãã‚‹ãŒã€è‡ªç„¶ãªã‚¹ãƒ”ãƒ¼ãƒ‰ã‚„é•·ã„æ–‡ç« ã«ãªã‚‹ã¨å‡¦ç†ãŒè¿½ã„ã¤ã‹ãªã„çŠ¶æ…‹ã§ã™ã€‚",
                    examples: [
                        "æ˜ ç”»ã‚„ãƒ‰ãƒ©ãƒã®è‹±èªãŒæ—©ã™ãã¦èãå–ã‚Œãªã„",
                        "é•·ã„æ–‡ç« ã®é€”ä¸­ã§å†…å®¹ã‚’å¿˜ã‚Œã¦ã—ã¾ã†",
                        "ä¼šè­°ã‚„ãƒ—ãƒ¬ã‚¼ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã«ã¤ã„ã¦ã„ã‘ãªã„",
                        "é›»è©±ã§ã®ä¼šè©±ãŒå›°é›£",
                        "è¤‡æ•°äººã®ä¼šè©±ã«å…¥ã‚Œãªã„"
                    ]
                }
            },
            text: {
                basic: {
                    title: "æ–‡ç«  - åŸºæœ¬çš„ãªæ–‡ã®ãƒ«ãƒ¼ãƒ«ï¼ˆæ–‡æ³•ï¼‰ãŒã‚ã‹ã‚‰ãªã„",
                    description: "è‹±èªã®åŸºæœ¬çš„ãªæ–‡æ³•æ§‹é€ ã‚„èªé †ãƒ«ãƒ¼ãƒ«ãŒç†è§£ã§ãã¦ã„ãªã„çŠ¶æ…‹ã§ã™ã€‚",
                    examples: [
                        "ä¸»èªãƒ»å‹•è©ãƒ»ç›®çš„èªã®é †ç•ªãŒã‚ã‹ã‚‰ãªã„",
                        "æ™‚åˆ¶ï¼ˆç¾åœ¨ãƒ»éå»ãƒ»æœªæ¥ï¼‰ãŒä½¿ã„åˆ†ã‘ã‚‰ã‚Œãªã„",
                        "ç–‘å•æ–‡ãƒ»å¦å®šæ–‡ã®ä½œã‚Šæ–¹ãŒã‚ã‹ã‚‰ãªã„",
                        "å‰ç½®è©ã®ä½¿ã„æ–¹ãŒã‚ã‹ã‚‰ãªã„",
                        "å˜æ•°ãƒ»è¤‡æ•°ã®æ¦‚å¿µãŒæ›–æ˜§"
                    ]
                },
                intermediate: {
                    title: "æ–‡ç«  - æ–‡ç« ã§ç†è§£ã§ããªã„ãƒ»æ–‡ã‚’çµ„ã¿ç«‹ã¦ã‚‰ã‚Œãªã„",
                    description: "åŸºæœ¬æ–‡æ³•ã¯ç†è§£ã—ã¦ã„ã‚‹ãŒã€å®Ÿéš›ã®æ–‡ç« ç†è§£ã‚„ä½œæ–‡ã§å›°é›£ã‚’æ„Ÿã˜ã¦ã„ã‚‹çŠ¶æ…‹ã§ã™ã€‚",
                    examples: [
                        "é•·ã„æ–‡ç« ã®æ§‹é€ ãŒæŠŠæ¡ã§ããªã„",
                        "é–¢ä¿‚ä»£åè©ã®æ–‡ãŒç†è§£ã§ããªã„",
                        "è‡ªåˆ†ã®è¨€ã„ãŸã„ã“ã¨ã‚’è‹±èªã§è¡¨ç¾ã§ããªã„",
                        "æ–‡ç« ã‚’èª­ã‚€ã®ã«æ™‚é–“ãŒã‹ã‹ã‚Šã™ãã‚‹",
                        "è¤‡é›‘ãªæ–‡æ³•æ§‹é€ ãŒä½¿ãˆãªã„"
                    ]
                },
                advanced: {
                    title: "æ–‡ç«  - æƒ…å ±é‡ãŒå¤šããªã‚‹ã¨ç†è§£ã§ããªã„ãƒ»è©±ã›ãªã„",
                    description: "åŸºæœ¬çš„ãªæ–‡ç« ã¯ç†è§£ã§ãã‚‹ãŒã€è¤‡é›‘ã§æƒ…å ±é‡ã®å¤šã„å†…å®¹ã«ãªã‚‹ã¨å‡¦ç†ãŒå›°é›£ãªçŠ¶æ…‹ã§ã™ã€‚",
                    examples: [
                        "è«–æ–‡ã‚„å°‚é–€æ–‡æ›¸ãŒèª­ã‚ãªã„",
                        "ãƒ“ã‚¸ãƒã‚¹æ–‡æ›¸ã®ä½œæˆãŒã§ããªã„",
                        "ãƒ—ãƒ¬ã‚¼ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã§è«–ç†çš„ã«è©±ã›ãªã„",
                        "ãƒ‡ã‚£ã‚¹ã‚«ãƒƒã‚·ãƒ§ãƒ³ã§æ„è¦‹ã‚’æ•´ç†ã—ã¦ä¼ãˆã‚‰ã‚Œãªã„",
                        "ãƒ‹ãƒ¥ã‚¢ãƒ³ã‚¹ã‚„å«æ„ãŒç†è§£ã§ããªã„"
                    ]
                }
            },
            vocabulary: {
                basic: {
                    title: "èªå½™ - åŸºæœ¬çš„ãªå˜èªãŒã‚ã‹ã‚‰ãªã„",
                    description: "æ—¥å¸¸ç”Ÿæ´»ã‚„åŸºæœ¬çš„ãªã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«å¿…è¦ãªèªå½™ãŒä¸è¶³ã—ã¦ã„ã‚‹çŠ¶æ…‹ã§ã™ã€‚",
                    examples: [
                        "ä¸­å­¦ãƒ¬ãƒ™ãƒ«ã®åŸºæœ¬å˜èªãŒã‚ã‹ã‚‰ãªã„",
                        "æ•°å­—ã‚„æ›œæ—¥ã€æœˆãŒè‹±èªã§è¨€ãˆãªã„",
                        "å®¶æ—ã‚„è·æ¥­ã®å˜èªãŒã‚ã‹ã‚‰ãªã„",
                        "åŸºæœ¬çš„ãªå‹•è©ï¼ˆeat, drink, goç­‰ï¼‰ãŒä½¿ãˆãªã„",
                        "è‰²ã‚„å½¢ã®å˜èªãŒã‚ã‹ã‚‰ãªã„"
                    ]
                },
                intermediate: {
                    title: "èªå½™ - ã¨ã£ã•ã«ç°¡å˜ãªå˜èªãŒå‡ºã¦ã“ãªã„",
                    description: "èªå½™ã¯çŸ¥ã£ã¦ã„ã‚‹ãŒã€ä¼šè©±ã‚„ä½œæ–‡ã§é©åˆ‡ãªå˜èªã‚’ç¬æ™‚ã«æ€ã„å‡ºã›ãªã„çŠ¶æ…‹ã§ã™ã€‚",
                    examples: [
                        "çŸ¥ã£ã¦ã„ã‚‹å˜èªãªã®ã«ä¼šè©±ã§å‡ºã¦ã“ãªã„",
                        "æ—¥æœ¬èªã§ã¯ç°¡å˜ã«è¨€ãˆã‚‹ã“ã¨ãŒè‹±èªã§è¡¨ç¾ã§ããªã„",
                        "å˜èªã‚’æ€ã„å‡ºã™ã®ã«æ™‚é–“ãŒã‹ã‹ã‚‹",
                        "åŒã˜å˜èªã°ã‹ã‚Šä½¿ã£ã¦ã—ã¾ã†",
                        "é¡ç¾©èªã®ä½¿ã„åˆ†ã‘ãŒã§ããªã„"
                    ]
                },
                advanced: {
                    title: "èªå½™ - æ–‡è„ˆã«å¿œã˜ãŸè¡¨ç¾ã®ä½¿ã„åˆ†ã‘ãŒã§ããªã„",
                    description: "è±Šå¯Œãªèªå½™ã¯æŒã£ã¦ã„ã‚‹ãŒã€å ´é¢ã‚„æ–‡è„ˆã«å¿œã˜ãŸé©åˆ‡ãªè¡¨ç¾é¸æŠãŒã§ããªã„çŠ¶æ…‹ã§ã™ã€‚",
                    examples: [
                        "ãƒ•ã‚©ãƒ¼ãƒãƒ«ãƒ»ã‚«ã‚¸ãƒ¥ã‚¢ãƒ«ã®ä½¿ã„åˆ†ã‘ãŒã§ããªã„",
                        "ãƒ“ã‚¸ãƒã‚¹å ´é¢ã§ã®é©åˆ‡ãªè¡¨ç¾ãŒã‚ã‹ã‚‰ãªã„",
                        "æ–‡åŒ–çš„ãªãƒ‹ãƒ¥ã‚¢ãƒ³ã‚¹ãŒç†è§£ã§ããªã„",
                        "å°‚é–€ç”¨èªã¨ä¸€èˆ¬ç”¨èªã®ä½¿ã„åˆ†ã‘ãŒã§ããªã„",
                        "ç›¸æ‰‹ã«å¿œã˜ãŸæ•¬èªãƒ¬ãƒ™ãƒ«ã®èª¿æ•´ãŒã§ããªã„"
                    ]
                }
            }
        };

        // ã‚«ãƒ¼ãƒ‰è©³ç´°ã®å±•é–‹ãƒ»æŠ˜ã‚ŠãŸãŸã¿æ©Ÿèƒ½
        function toggleCardDetails(element) {
            const card = element.closest ? element.closest('.expandable-card') : element;
            const details = card.querySelector('.card-details');
            
            if (details) {
                if (details.style.display === 'none' || details.style.display === '') {
                    details.style.display = 'block';
                    card.classList.add('expanded');
                } else {
                    details.style.display = 'none';
                    card.classList.remove('expanded');
                }
            }
        }
        
        // èª²é¡Œãƒ»å¯¾ç­–ãƒ»ã‚¢ãƒ—ãƒ­ãƒ¼ãƒã‚«ãƒ¼ãƒ‰ã‚’æ›´æ–°
        function updateChallengeSolutionCards() {
            const container = document.getElementById('challenge-solution-grid');
            const challengeSolutions = [];
            
            // é¸æŠã•ã‚ŒãŸèª²é¡Œã«åŸºã¥ã„ã¦ã‚«ãƒ¼ãƒ‰ã‚’ç”Ÿæˆ
            const selectedSkills = getSelectedSkills();
            
            if (selectedSkills.sound.length > 0) {
                selectedSkills.sound.forEach(level => {
                    challengeSolutions.push(createChallengeSolutionCard('sound', level));
                });
            }
            if (selectedSkills.text.length > 0) {
                selectedSkills.text.forEach(level => {
                    challengeSolutions.push(createChallengeSolutionCard('text', level));
                });
            }
            if (selectedSkills.vocabulary.length > 0) {
                selectedSkills.vocabulary.forEach(level => {
                    challengeSolutions.push(createChallengeSolutionCard('vocabulary', level));
                });
            }
            
            container.innerHTML = challengeSolutions.join('');
        }
        
        function createChallengeSolutionCard(skill, level) {
            const skillData = {
                sound: { icon: 'ğŸ§', name: 'éŸ³å£°' },
                text: { icon: 'ğŸ“', name: 'æ–‡ç« ' },
                vocabulary: { icon: 'ğŸ“–', name: 'èªå½™' }
            };
            
            const challengeData = challengeDetails[skill][level];
            const solutions = getSolutionForChallenge(skill, level);
            
            return `
                <div class="challenge-solution-card" onclick="selectChallengeSolution('${skill}', '${level}')">
                    <div class="challenge-header">
                        <div class="challenge-icon">${skillData[skill].icon}</div>
                        <div class="challenge-title">${skillData[skill].name}ã®èª²é¡Œ</div>
                    </div>
                    <div class="challenge-description">${challengeData.title.split(' - ')[1]}</div>
                    
                    <div class="solution-section">
                        <div class="solution-section-title">ğŸ¯ å¯¾ç­–</div>
                        <div class="solution-content">${solutions.strategy}</div>
                    </div>
                    
                    <div class="solution-section">
                        <div class="solution-section-title">ğŸ“š ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ</div>
                        <div class="solution-content">${solutions.approach}</div>
                        <div class="approach-tags">
                            ${solutions.methods.map(method => `<span class="approach-tag">${method}</span>`).join('')}
                        </div>
                    </div>
                </div>
            `;
        }
        
        function getSolutionForChallenge(skill, level) {
            const solutions = {
                sound: {
                    basic: {
                        strategy: "éŸ³ã®ãƒ«ãƒ¼ãƒ«ã‚’åŸºç¤ã‹ã‚‰å­¦ç¿’ã—ã€ç™ºéŸ³ã®åŸºæœ¬ã‚’èº«ã«ã¤ã‘ã‚‹",
                        approach: "ç™ºéŸ³è¨˜å·ã®å­¦ç¿’ã€åŸºæœ¬çš„ãªéŸ³ã®ç·´ç¿’ã€ã‚¢ã‚¯ã‚»ãƒ³ãƒˆãƒ»ãƒªã‚ºãƒ ã®ç¿’å¾—",
                        methods: ["ç™ºéŸ³è¨˜å·å­¦ç¿’", "éŸ³èª­ç·´ç¿’", "åŸºç¤ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°"]
                    },
                    intermediate: {
                        strategy: "éŸ³ã‚’å†ç¾ã§ãã‚‹ï¼ˆç™ºè©±ã§ãã‚‹ï¼‰ã“ã¨ãŒã‚´ãƒ¼ãƒ«",
                        approach: "éŸ³èª­/ã‚·ãƒ£ãƒ‰ãƒ¼ã‚¤ãƒ³ã‚°ï¼ˆãƒ¬ãƒ™ãƒ«ã«åˆã‚ã›ãŸé€Ÿã•ï¼‰ã€ç™ºéŸ³çŸ¯æ­£ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°",
                        methods: ["ã‚·ãƒ£ãƒ‰ãƒ¼ã‚¤ãƒ³ã‚°", "éŸ³èª­ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°", "ç™ºéŸ³çŸ¯æ­£"]
                    },
                    advanced: {
                        strategy: "è‡ªç„¶ãªã‚¹ãƒ”ãƒ¼ãƒ‰ã§ã®éŸ³å£°å‡¦ç†èƒ½åŠ›ã‚’å‘ä¸Šã•ã›ã‚‹",
                        approach: "é«˜é€ŸéŸ³å£°ã¸ã®æ…£ã‚Œã€é•·æ–‡ãƒªã‚¹ãƒ‹ãƒ³ã‚°ã€å®Ÿè·µçš„ãªä¼šè©±ç·´ç¿’",
                        methods: ["é«˜é€Ÿã‚·ãƒ£ãƒ‰ãƒ¼ã‚¤ãƒ³ã‚°", "å®Ÿè·µä¼šè©±", "é•·æ–‡ãƒªã‚¹ãƒ‹ãƒ³ã‚°"]
                    }
                },
                text: {
                    basic: {
                        strategy: "åŸºæœ¬çš„ãªæ–‡æ³•ãƒ«ãƒ¼ãƒ«ã‚’ä½“ç³»çš„ã«å­¦ç¿’ã™ã‚‹",
                        approach: "ä¸­å­¦ãƒ»é«˜æ ¡ãƒ¬ãƒ™ãƒ«ã®æ–‡æ³•å¾©ç¿’ã€åŸºæœ¬æ–‡å‹ã®ç¿’å¾—",
                        methods: ["åŸºç¤æ–‡æ³•", "æ–‡å‹ç·´ç¿’", "ä¾‹æ–‡æš—è¨˜"]
                    },
                    intermediate: {
                        strategy: "ã¨ã«ã‹ãè‹±èªã®æ–‡ç« ã‚’ã‚¯ã‚¤ãƒƒã‚¯ã«çµ„ã‚€ã“ã¨",
                        approach: "ç¬é–“è‹±ä½œæ–‡ã€ã‚«ãƒ©ãƒ³ãƒ¡ã‚½ãƒƒãƒ‰ãªã©ã€è‹±ä½œæ–‡ç³»ã‚¨ã‚¯ã‚µã‚µã‚¤ã‚º",
                        methods: ["ç¬é–“è‹±ä½œæ–‡", "ã‚«ãƒ©ãƒ³ãƒ¡ã‚½ãƒƒãƒ‰", "æ–‡æ§‹é€ ç·´ç¿’"]
                    },
                    advanced: {
                        strategy: "ã‚¯ã‚¤ãƒƒã‚¯ã«æ§‹é€ åŒ–ã™ã‚‹ã“ã¨",
                        approach: "æ–‡è„ˆã«åˆã‚ã›ãŸè¡¨ç¾ã®é¸å®šã€é•·ã„æ–‡ç« ã®å¤šè´å¤šèª­",
                        methods: ["æ§‹é€ åŒ–ç·´ç¿’", "å¤šè´å¤šèª­", "è¡¨ç¾é¸å®š"]
                    }
                },
                vocabulary: {
                    basic: {
                        strategy: "åŸºæœ¬èªå½™ã‚’ç€å®Ÿã«å¢—ã‚„ã—ã€å®šç€ã•ã›ã‚‹",
                        approach: "é »å‡ºå˜èªã®æš—è¨˜ã€åŸºæœ¬èªå½™ã®åå¾©å­¦ç¿’",
                        methods: ["åŸºæœ¬èªå½™", "åå¾©å­¦ç¿’", "èªå½™ãƒ†ã‚¹ãƒˆ"]
                    },
                    intermediate: {
                        strategy: "èªå½™ã®ç¬ç™ºåŠ›ã‚’å‘ä¸Šã•ã›ã‚‹",
                        approach: "èªå½™ã®ä½¿ã„åˆ†ã‘ç·´ç¿’ã€ç¬ç™ºçš„ãªèªå½™æƒ³èµ·ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°",
                        methods: ["èªå½™æƒ³èµ·", "ä½¿ã„åˆ†ã‘", "å®Ÿè·µç·´ç¿’"]
                    },
                    advanced: {
                        strategy: "æ–‡è„ˆã«å¿œã˜ãŸé©åˆ‡ãªè¡¨ç¾ã‚’é¸æŠã§ãã‚‹ã‚ˆã†ã«ãªã‚‹",
                        approach: "ãƒ‹ãƒ¥ã‚¢ãƒ³ã‚¹ã®ç†è§£ã€å ´é¢åˆ¥è¡¨ç¾ã®ç¿’å¾—ã€å®Ÿè·µçš„ãªä½¿ç”¨ç·´ç¿’",
                        methods: ["ãƒ‹ãƒ¥ã‚¢ãƒ³ã‚¹å­¦ç¿’", "å ´é¢åˆ¥è¡¨ç¾", "å®Ÿè·µä½¿ç”¨"]
                    }
                }
            };
            
            return solutions[skill][level];
        }
        
        // èª²é¡Œãƒ»å¯¾ç­–ã‚«ãƒ¼ãƒ‰ã®é¸æŠ
        let selectedChallenge = null;
        
        function selectChallengeSolution(skill, level) {
            // æ—¢å­˜ã®é¸æŠã‚’è§£é™¤
            document.querySelectorAll('.challenge-solution-card').forEach(card => {
                card.classList.remove('selected');
            });
            
            // æ–°ã—ã„é¸æŠã‚’è¿½åŠ 
            event.currentTarget.classList.add('selected');
            selectedChallenge = { skill, level };
        }
        
        // ğŸ·ï¸ æ–°ã—ã„ã‚¿ã‚°ãƒ™ãƒ¼ã‚¹ã®ã‚µãƒ¼ãƒ“ã‚¹ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°
        function getFilteredServices() {
            console.log('ğŸ·ï¸ ã‚¿ã‚°ãƒ™ãƒ¼ã‚¹ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°é–‹å§‹');
            console.log('Current userSelections:', userSelections);
            
            // ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®é¸æŠã‹ã‚‰TOEICãƒ¬ãƒ™ãƒ«ã‚’æ±ºå®š
            const toeicLevel = getToeicLevelFromSelection();
            console.log('ğŸ“Š Determined TOEIC level:', toeicLevel);
            
            // é¸æŠã•ã‚ŒãŸã‚¹ã‚­ãƒ«ã¨é›£æ˜“åº¦ã‚’å–å¾—
            const selectedSkills = [];
            const selectedDifficulties = [];
            
            const skillsData = getSelectedSkills();
            console.log('ğŸ¯ Skills data:', skillsData);
            
            if (skillsData.sound.length > 0) {
                selectedSkills.push('sound');
                selectedDifficulties.push(...skillsData.sound);
            }
            if (skillsData.text.length > 0) {
                selectedSkills.push('text');
                selectedDifficulties.push(...skillsData.text);
            }
            if (skillsData.vocabulary.length > 0) {
                selectedSkills.push('vocabulary');
                selectedDifficulties.push(...skillsData.vocabulary);
            }
            
            console.log('ğŸ¯ Selected skills:', selectedSkills);
            console.log('ğŸ¯ Selected difficulties:', selectedDifficulties);
            
            // é¸æŠãŒãªã„å ´åˆã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚µãƒ¼ãƒ“ã‚¹ã‚’è¿”ã™
            if (selectedSkills.length === 0) {
                console.log('âš ï¸ ã‚¹ã‚­ãƒ«é¸æŠãªã—ã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚µãƒ¼ãƒ“ã‚¹ã‚’è¡¨ç¤º');
                return allServices.slice(0, 6); // æœ€åˆã®6ã¤ã®ã‚µãƒ¼ãƒ“ã‚¹
            }
            
            console.log('ğŸ” Total services available:', allServices.length);
            allServices.forEach((service, i) => {
                console.log(`Service ${i+1}: ${service.name} - Skills: ${service.tags.skills}, Difficulties: ${service.tags.difficulties}, TOEIC: ${service.tags.toeicLevels}`);
            });
            
            console.log('Filtering criteria:', {
                toeicLevel,
                selectedSkills,
                selectedDifficulties
            });
            
            // ã‚µãƒ¼ãƒ“ã‚¹ã‚’ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°
            const filteredServices = allServices.filter(service => {
                // TOEICãƒ¬ãƒ™ãƒ«ãƒãƒƒãƒ
                const toeicMatch = service.tags.toeicLevels.includes(toeicLevel);
                
                // ã‚¹ã‚­ãƒ«ãƒãƒƒãƒï¼ˆé¸æŠã•ã‚ŒãŸã‚¹ã‚­ãƒ«ã®ã„ãšã‚Œã‹ã«å¯¾å¿œï¼‰
                const skillMatch = selectedSkills.some(skill => 
                    service.tags.skills.includes(skill)
                );
                
                // é›£æ˜“åº¦ãƒãƒƒãƒï¼ˆé¸æŠã•ã‚ŒãŸé›£æ˜“åº¦ã®ã„ãšã‚Œã‹ã«å¯¾å¿œï¼‰
                const difficultyMatch = selectedDifficulties.some(difficulty => 
                    service.tags.difficulties.includes(difficulty)
                );
                
                const matches = toeicMatch && skillMatch && difficultyMatch;
                
                if (matches) {
                    console.log(`âœ… ${service.name} ãƒãƒƒãƒ:`, {
                        toeic: toeicMatch,
                        skill: skillMatch,
                        difficulty: difficultyMatch
                    });
                }
                
                return matches;
            });
            
            console.log(`ğŸ¯ ãƒ•ã‚£ãƒ«ã‚¿çµæœ: ${filteredServices.length}ä»¶ã®ã‚µãƒ¼ãƒ“ã‚¹`);
            return filteredServices;
        }
        
        // TOEICãƒ¬ãƒ™ãƒ«ã‚’é¸æŠã‹ã‚‰æ±ºå®š
        function getToeicLevelFromSelection() {
            // ç›´æ¥TOEICãƒ¬ãƒ™ãƒ«ãŒé¸æŠã•ã‚Œã¦ã„ã‚‹å ´åˆ
            if (userSelections.toeic) {
                const toeicMapping = {
                    'basic': '300-600',
                    'intermediate': '600-750', 
                    'advanced': '750+'
                };
                return toeicMapping[userSelections.toeic] || '600-750';
            }
            
            // ã‚¹ã‚­ãƒ«é¸æŠã‹ã‚‰æ¨å®š
            const skillsData = getSelectedSkills();
            const difficulties = [
                ...skillsData.sound,
                ...skillsData.text, 
                ...skillsData.vocabulary
            ].filter(d => d !== null && d !== undefined);
            
            if (difficulties.length === 0) return '600-750'; // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ
            
            const basicCount = difficulties.filter(d => d === 'basic').length;
            const advancedCount = difficulties.filter(d => d === 'advanced').length;
            
            if (basicCount >= 2) return '300-600';
            if (advancedCount >= 2) return '750+';
            return '600-750';
        }
        
        // ğŸ“Š CSVã‹ã‚‰æ›´æ–°ã•ã‚ŒãŸã‚¿ã‚°ãƒ™ãƒ¼ã‚¹ã®ã‚µãƒ¼ãƒ“ã‚¹ãƒ‡ãƒ¼ã‚¿
        const allServices = [
            {
                name: "ã‚¹ã‚¿ãƒ‡ã‚£ã‚µãƒ—ãƒª ENGLISH",
                price: "æœˆé¡2,178å††",
                logo: "ğŸ“š",
                tags: {
                    toeicLevels: ["300-600"],
                    skills: ["sound", "text", "vocabulary"],
                    difficulties: ["basic"],
                    learningStyle: "self-study",
                    specialties: ["\u30b9\u30de\u30db\u5b66\u7fd2\u30fbAI\u5b66\u7fd2\u30fb\u9032\u6357\u7ba1\u7406"]
                },
                    details: {
                    "å­¦ç¿’å†…å®¹": ["åŸºæœ¬å˜èªå­¦ç¿’", "åŸºç¤å›ºã‚ãƒ»ç™ºéŸ³ç·´ç¿’", "åŸºç¤æ–‡æ³•ãƒ»èª­è§£"],
                    "ç‰¹å¾´": ["ã‚¹ãƒãƒ›å­¦ç¿’ãƒ»AIå­¦ç¿’ãƒ»é€²æ—ç®¡ç†"]
                },
                url: "https://eigosapuri.jp/"
            },
            {
                name: "abceed",
                price: "æœˆé¡1,650å††",
                logo: "ğŸ“±",
                tags: {
                    toeicLevels: ["300-600"],
                    skills: ["sound", "text", "vocabulary"],
                    difficulties: ["basic"],
                    learningStyle: "self-study",
                    specialties: ["AI\u4e88\u6e2c\u30b9\u30b3\u30a2\u30fb\u8c4a\u5bcc\u306a\u554f\u984c\u96c6"]
                },
                    details: {
                    "å­¦ç¿’å†…å®¹": ["åŸºæœ¬å˜èªå­¦ç¿’", "åŸºç¤å›ºã‚ãƒ»ç™ºéŸ³ç·´ç¿’", "åŸºç¤æ–‡æ³•ãƒ»èª­è§£"],
                    "ç‰¹å¾´": ["AIäºˆæ¸¬ã‚¹ã‚³ã‚¢ãƒ»è±Šå¯Œãªå•é¡Œé›†"]
                },
                url: "https://www.abceed.com/"
            },
            {
                name: "DMMè‹±ä¼šè©±",
                price: "æœˆé¡5,450å††",
                    logo: "ğŸ’¬",
                tags: {
                    toeicLevels: ["300-600", "600-750"],
                    skills: ["sound", "text"],
                    difficulties: ["basic", "intermediate"],
                    learningStyle: "instructor-led",
                    specialties: ["\u591a\u56fd\u7c4d\u8b1b\u5e2b\u30fb24\u6642\u9593\u5bfe\u5fdc"]
                },
                    details: {
                    "å­¦ç¿’å†…å®¹": ["ãƒ“ã‚¸ãƒã‚¹è‹±ä¼šè©±", "åŸºç¤æ–‡æ³•ãƒ»ä¼šè©±ç·´ç¿’", "æ—¥å¸¸è‹±ä¼šè©±", "ç™ºéŸ³ç·´ç¿’ãƒ»åŸºç¤ä¼šè©±"],
                    "ç‰¹å¾´": ["å¤šå›½ç±è¬›å¸«ãƒ»24æ™‚é–“å¯¾å¿œ"]
                },
                url: "https://eikaiwa.dmm.com/"
            },
            {
                name: "SHADOTEN",
                price: "æœˆé¡21,780å††",
                logo: "ğŸ¯",
                tags: {
                    toeicLevels: ["600-750", "750+"],
                    skills: ["sound"],
                    difficulties: ["advanced", "intermediate"],
                    learningStyle: "self-study",
                    specialties: ["\u30d7\u30ed\u6dfb\u524a\u30fb\u97f3\u58f0\u5206\u6790"]
                },
                    details: {
                    "å­¦ç¿’å†…å®¹": ["ã‚·ãƒ£ãƒ‰ãƒ¼ã‚¤ãƒ³ã‚°è¨“ç·´"],
                    "ç‰¹å¾´": ["ãƒ—ãƒ­æ·»å‰Šãƒ»éŸ³å£°åˆ†æ"]
                },
                url: "https://www.shadoten.com/"
            },
            {
                name: "AIè‹±ä¼šè©± ã‚¹ãƒ”ãƒ¼ã‚¯ãƒãƒ‡ã‚£",
                price: "æœˆé¡3,300å††",
                logo: "ğŸ¤–",
                tags: {
                    toeicLevels: ["300-600", "600-750"],
                    skills: ["vocabulary"],
                    difficulties: ["basic", "intermediate"],
                    learningStyle: "ai-learning",
                    specialties: ["24\u6642\u9593\u5229\u7528\u30fb\u6065\u305a\u304b\u3057\u304f\u306a\u3044"]
                },
                    details: {
                    "å­¦ç¿’å†…å®¹": ["èªå½™å®šç€ç·´ç¿’", "èªå½™æ´»ç”¨ç·´ç¿’"],
                    "ç‰¹å¾´": ["24æ™‚é–“åˆ©ç”¨ãƒ»æ¥ãšã‹ã—ããªã„"]
                },
                url: "https://www.speakbuddy.me/"
                },
                {
                    name: "Speak",
                price: "æœˆé¡1,800å††",
                logo: "ğŸ—£ï¸",
                tags: {
                    toeicLevels: ["600-750", "750+"],
                    skills: ["vocabulary"],
                    difficulties: ["advanced", "intermediate"],
                    learningStyle: "ai-learning",
                    specialties: ["\u9ad8\u7cbe\u5ea6AI\u30fb\u5b9f\u8df5\u7684"]
                },
                    details: {
                    "å­¦ç¿’å†…å®¹": ["è¡¨ç¾åŠ›å‘ä¸Š"],
                    "ç‰¹å¾´": ["é«˜ç²¾åº¦AIãƒ»å®Ÿè·µçš„"]
                },
                url: "https://www.speak.com/"
            },
            {
                name: "SUPIFUL",
                price: "æœˆé¡4,378å††",
                logo: "âœï¸",
                tags: {
                    toeicLevels: ["600-750", "750+"],
                    skills: ["text", "vocabulary"],
                    difficulties: ["advanced", "intermediate"],
                    learningStyle: "self-study",
                    specialties: ["AI\u6dfb\u524a\u30fb\u30a2\u30a6\u30c8\u30d7\u30c3\u30c8\u91cd\u8996"]
                },
                    details: {
                    "å­¦ç¿’å†…å®¹": ["è‹±ä½œæ–‡ç·´ç¿’ãƒ»ã‚¹ãƒ”ãƒ¼ã‚­ãƒ³ã‚°è¨“ç·´", "è¡¨ç¾åŠ›å‘ä¸Š"],
                    "ç‰¹å¾´": ["AIæ·»å‰Šãƒ»ã‚¢ã‚¦ãƒˆãƒ—ãƒƒãƒˆé‡è¦–"]
                },
                url: "https://supiful.com/"
            },
            {
                name: "QQ English",
                price: "æœˆé¡2,980å††",
                logo: "âš¡",
                tags: {
                    toeicLevels: ["600-750", "750+"],
                    skills: ["sound", "text"],
                    difficulties: ["advanced", "intermediate"],
                    learningStyle: "instructor-led",
                    specialties: ["\u9ad8\u901f\u5b66\u7fd2\u30fb\u96c6\u4e2d\u8a13\u7df4"]
                },
                    details: {
                    "å­¦ç¿’å†…å®¹": ["ã‚«ãƒ©ãƒ³ãƒ¡ã‚½ãƒƒãƒ‰ãƒ»4å€é€Ÿå­¦ç¿’", "ç¬é–“è‹±ä½œæ–‡"],
                    "ç‰¹å¾´": ["é«˜é€Ÿå­¦ç¿’ãƒ»é›†ä¸­è¨“ç·´"]
                },
                url: "https://www.qqeng.com/"
                },
                {
                    name: "Bizmates",
                price: "æœˆé¡13,200å††",
                    logo: "ğŸ’¼",
                tags: {
                    toeicLevels: ["750+"],
                    skills: ["text", "vocabulary"],
                    difficulties: ["advanced"],
                    learningStyle: "instructor-led",
                    specialties: ["\u30d3\u30b8\u30cd\u30b9\u7279\u5316\u30fb\u5b9f\u52d9\u7d4c\u9a13\u8b1b\u5e2b"]
                },
                    details: {
                    "å­¦ç¿’å†…å®¹": ["ãƒ“ã‚¸ãƒã‚¹è‹±ä¼šè©±ãƒ»ãƒ—ãƒ¬ã‚¼ãƒ³ç·´ç¿’", "ãƒ“ã‚¸ãƒã‚¹èªå½™ãƒ»äº¤æ¸‰ã‚¹ã‚­ãƒ«"],
                    "ç‰¹å¾´": ["ãƒ“ã‚¸ãƒã‚¹ç‰¹åŒ–ãƒ»å®Ÿå‹™çµŒé¨“è¬›å¸«"]
                    },
                    url: "https://www.bizmates.jp/"
                },
                {
                name: "Native Camp",
                price: "æœˆé¡6,480å††",
                logo: "ğŸŒ",
                tags: {
                    toeicLevels: ["600-750", "750+"],
                    skills: ["text"],
                    difficulties: ["advanced", "intermediate"],
                    learningStyle: "self-study",
                    specialties: []
                },
                    details: {
                    "å­¦ç¿’å†…å®¹": ["ã‚«ãƒ©ãƒ³ãƒ¡ã‚½ãƒƒãƒ‰ãƒ»4å€é€Ÿå­¦ç¿’"],
                    "ç‰¹å¾´": []
                },
                url: "https://nativecamp.net/"
            }
        ];
        
        function updateRecommendationTitle() {
            const level = determineUserLevel();
            const levelMap = {
                basic: { level: 'A1', nextLevel: 'A2' },
                intermediate: { level: 'A2', nextLevel: 'B1' },
                advanced: { level: 'B1', nextLevel: 'B2' }
            };
            
            const info = levelMap[level];
            const title = document.getElementById('recommendation-title');
            const subtitle = document.getElementById('recommendation-subtitle');
            
            title.textContent = `${info.level}ãƒ¬ãƒ™ãƒ« â†’ ${info.nextLevel}ãƒ¬ãƒ™ãƒ«ã¸ã®å­¦ç¿’ãƒ—ãƒ©ãƒ³`;
            
            // é¸æŠã•ã‚ŒãŸå†…å®¹ã«åŸºã¥ã„ã¦ã‚µãƒ–ã‚¿ã‚¤ãƒˆãƒ«ã‚’æ›´æ–°
            const selectedCategories = [];
            const skillsData = getSelectedSkills();
            
            if (hasSkillSelection('sound', 'basic')) selectedCategories.push('åŸºç¤å¯¾ç­–');
            if (hasSkillSelection('sound', 'intermediate') || hasSkillSelection('sound', 'advanced')) selectedCategories.push('éŸ³ã®å¯¾ç­–');
            if (hasSkillSelection('text', 'intermediate') || hasSkillSelection('text', 'advanced') || 
                hasSkillSelection('vocabulary', 'intermediate') || hasSkillSelection('vocabulary', 'advanced')) {
                selectedCategories.push('çŸ­ã„æ–‡ç« ã¨èªå½™ã®å¯¾ç­–');
            }
            if (hasSkillSelection('text', 'advanced') || hasSkillSelection('vocabulary', 'advanced')) {
                selectedCategories.push('é•·ã„æ–‡ç« ã¨è¡¨ç¾ã®å¯¾ç­–');
            }
            
            if (selectedCategories.length > 0) {
                subtitle.textContent = selectedCategories.join(' ï¼‹ ');
            } else {
                subtitle.textContent = 'åŸºç¤å¯¾ç­–';
            }
        }
        
        function getSelectedServices() {
            // æ–°ã—ã„ã‚¿ã‚°ãƒ™ãƒ¼ã‚¹ã‚·ã‚¹ãƒ†ãƒ ã‚’ä½¿ç”¨
            return getFilteredServices();
        }
        
        function determineUserLevel() {
            // é¸æŠã•ã‚ŒãŸãƒ¬ãƒ™ãƒ«ã«åŸºã¥ã„ã¦åˆ¤å®š
            const levels = Object.values(userSelections).filter(l => l !== null);
            
            if (levels.length === 0) return 'intermediate'; // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ
            
            const basicCount = levels.filter(l => l === 'basic').length;
            const advancedCount = levels.filter(l => l === 'advanced').length;
            const intermediateCount = levels.filter(l => l === 'intermediate').length;
            
            // æœ€ã‚‚å¤šã„ãƒ¬ãƒ™ãƒ«ã‚’è¿”ã™
            if (basicCount >= intermediateCount && basicCount >= advancedCount) return 'basic';
            if (advancedCount >= intermediateCount && advancedCount >= basicCount) return 'advanced';
            return 'intermediate';
        }
        
        function updateLevelResult() {
            // ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒ¬ãƒ™ãƒ«ã‚’åˆ¤å®š
            const level = determineUserLevel();
            const levelMap = {
                basic: { level: 'A1', description: 'åŸºç¤ã‹ã‚‰å§‹ã‚ã‚‹ãƒ¬ãƒ™ãƒ«ï¼ˆTOEIC 300-600ï¼‰' },
                intermediate: { level: 'A2', description: 'åŸºç¤èªå½™ãŒã‚ã‚‹ç¨‹åº¦ç†è§£ã§ãã‚‹ãƒ¬ãƒ™ãƒ«ï¼ˆTOEIC 600-750ï¼‰' },
                advanced: { level: 'B1', description: 'æ—¥å¸¸ä¼šè©±ãŒã§ãã‚‹ãƒ¬ãƒ™ãƒ«ï¼ˆTOEIC 750ç‚¹ä»¥ä¸Šï¼‰' }
            };
            
            const info = levelMap[level];
            
            // ãƒ¬ãƒ™ãƒ«è¡¨ç¤ºã‚’æ›´æ–°
            document.getElementById('user-level').textContent = info.level;
            document.getElementById('level-description').textContent = info.description;
            
            // ã‚¹ãƒ†ãƒ¼ã‚¸ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³ã‚’æ›´æ–°
            updateStageTimeline(info.level);
            
            // èª²é¡Œãƒ»å¯¾ç­–ãƒ»ã‚¢ãƒ—ãƒ­ãƒ¼ãƒã®ã‚«ãƒ¼ãƒ‰ã‚’ç”Ÿæˆ
            updateChallengeSolutionCards();
        }
        
        function updateStageTimeline(currentLevel) {
            const stages = ['A1', 'A2', 'B1', 'B2', 'C1', 'C2'];
            const currentIndex = stages.indexOf(currentLevel);
            
            stages.forEach((stage, index) => {
                const stageElement = document.querySelector(`[data-level="${stage}"]`);
                stageElement.classList.remove('passed', 'current');
                
                if (index < currentIndex) {
                    stageElement.classList.add('passed');
                } else if (index === currentIndex) {
                    stageElement.classList.add('current');
                }
            });
        }
        
        function updateSolutionTabs() {
            const tabsContainer = document.getElementById('solution-tabs');
            const contentContainer = document.getElementById('solution-content');
            
            // é¸æŠã•ã‚ŒãŸå†…å®¹ã«åŸºã¥ã„ã¦ã‚¿ãƒ–ã‚’ç”Ÿæˆ
            const tabs = [];
            const contents = {};
            
            if (hasSkillSelection('sound', 'intermediate') || hasSkillSelection('sound', 'advanced')) {
                tabs.push({ id: 'sound', name: 'éŸ³ã®å¯¾ç­–' });
                contents.sound = [
                    'éŸ³ã‚’å†ç¾ã§ãã‚‹ï¼ˆç™ºè©±ã§ãã‚‹ï¼‰ã“ã¨ãŒã‚´ãƒ¼ãƒ«',
                    'éŸ³èª­/ã‚·ãƒ£ãƒ‰ãƒ¼ã‚¤ãƒ³ã‚°ï¼ˆãƒ¬ãƒ™ãƒ«ã«åˆã‚ã›ãŸé€Ÿã•ï¼‰',
                    'ç™ºéŸ³çŸ¯æ­£ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°'
                ];
            }
            
            if (hasSkillSelection('text', 'intermediate') || hasSkillSelection('text', 'advanced') || 
                hasSkillSelection('vocabulary', 'intermediate') || hasSkillSelection('vocabulary', 'advanced')) {
                tabs.push({ id: 'grammar', name: 'çŸ­ã„æ–‡ç« ã¨èªå½™ã®å¯¾ç­–' });
                contents.grammar = [
                    'ã¨ã«ã‹ãè‹±èªã®æ–‡ç« ã‚’ã‚¯ã‚¤ãƒƒã‚¯ã«çµ„ã‚€ã“ã¨',
                    'ç¬é–“è‹±ä½œæ–‡ã€ã‚«ãƒ©ãƒ³ãƒ¡ã‚½ãƒƒãƒ‰ãªã©ã€è‹±ä½œæ–‡ç³»ã‚¨ã‚¯ã‚µã‚µã‚¤ã‚º',
                    'èªå½™åŠ›å¼·åŒ–ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°'
                ];
            }
            
            if (hasSkillSelection('text', 'advanced') || hasSkillSelection('vocabulary', 'advanced')) {
                tabs.push({ id: 'advanced', name: 'é•·ã„æ–‡ç« ã¨è¡¨ç¾ã®å¯¾ç­–' });
                contents.advanced = [
                    'ã‚¯ã‚¤ãƒƒã‚¯ã«æ§‹é€ åŒ–ã™ã‚‹ã“ã¨',
                    'æ–‡è„ˆã«åˆã‚ã›ãŸè¡¨ç¾ã®é¸å®š',
                    'é•·ã„æ–‡ç« ã®å¤šè´å¤šèª­ã‚„ã€ä¼šè©±ã§ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã‚’å—ã‘ã‚‹ã“ã¨ãŒé‡è¦'
                ];
            }
            
            // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚¿ãƒ–ã‚’è¿½åŠ ï¼ˆé¸æŠãŒãªã„å ´åˆï¼‰
            if (tabs.length === 0) {
                tabs.push({ id: 'basic', name: 'åŸºç¤å¯¾ç­–' });
                contents.basic = [
                    'éŸ³ã®ãƒ«ãƒ¼ãƒ«ã€æ–‡ç« ã®ãƒ«ãƒ¼ãƒ«ã€åŸºæœ¬çš„ãªå˜èªãªã©ã€ä¸­å­¦/é«˜æ ¡ã®ãŠã•ã‚‰ã„ãŒä¸­å¿ƒ',
                    'åŒæ™‚ã«ã€è‡ªå·±å­¦ç¿’ã®ç¿’æ…£/çµŒé¨“ã‚’ç©ã‚€ã“ã¨ãŒé‡è¦'
                ];
            }
            
            // ã‚¿ãƒ–ã‚’ç”Ÿæˆ
            tabsContainer.innerHTML = tabs.map((tab, index) => 
                `<div class="nav-tab ${index === 0 ? 'active' : ''}" onclick="showSolution('${tab.id}')">${tab.name}</div>`
            ).join('');
            
            // æœ€åˆã®ã‚¿ãƒ–ã®å†…å®¹ã‚’è¡¨ç¤º
            const firstTabId = tabs[0].id;
            showSolutionContent(firstTabId, contents[firstTabId]);
        }
        
        function showSolution(tabId) {
            // ã‚¿ãƒ–ã®åˆ‡ã‚Šæ›¿ãˆ
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // å†…å®¹ã‚’å‹•çš„ã«ç”Ÿæˆ
            const contents = {
                sound: [
                    'éŸ³ã‚’å†ç¾ã§ãã‚‹ï¼ˆç™ºè©±ã§ãã‚‹ï¼‰ã“ã¨ãŒã‚´ãƒ¼ãƒ«',
                    'éŸ³èª­/ã‚·ãƒ£ãƒ‰ãƒ¼ã‚¤ãƒ³ã‚°ï¼ˆãƒ¬ãƒ™ãƒ«ã«åˆã‚ã›ãŸé€Ÿã•ï¼‰',
                    'ç™ºéŸ³çŸ¯æ­£ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°'
                ],
                grammar: [
                    'ã¨ã«ã‹ãè‹±èªã®æ–‡ç« ã‚’ã‚¯ã‚¤ãƒƒã‚¯ã«çµ„ã‚€ã“ã¨',
                    'ç¬é–“è‹±ä½œæ–‡ã€ã‚«ãƒ©ãƒ³ãƒ¡ã‚½ãƒƒãƒ‰ãªã©ã€è‹±ä½œæ–‡ç³»ã‚¨ã‚¯ã‚µã‚µã‚¤ã‚º',
                    'èªå½™åŠ›å¼·åŒ–ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°'
                ],
                advanced: [
                    'ã‚¯ã‚¤ãƒƒã‚¯ã«æ§‹é€ åŒ–ã™ã‚‹ã“ã¨',
                    'æ–‡è„ˆã«åˆã‚ã›ãŸè¡¨ç¾ã®é¸å®š',
                    'é•·ã„æ–‡ç« ã®å¤šè´å¤šèª­ã‚„ã€ä¼šè©±ã§ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã‚’å—ã‘ã‚‹ã“ã¨ãŒé‡è¦'
                ],
                basic: [
                    'éŸ³ã®ãƒ«ãƒ¼ãƒ«ã€æ–‡ç« ã®ãƒ«ãƒ¼ãƒ«ã€åŸºæœ¬çš„ãªå˜èªãªã©ã€ä¸­å­¦/é«˜æ ¡ã®ãŠã•ã‚‰ã„ãŒä¸­å¿ƒ',
                    'åŒæ™‚ã«ã€è‡ªå·±å­¦ç¿’ã®ç¿’æ…£/çµŒé¨“ã‚’ç©ã‚€ã“ã¨ãŒé‡è¦'
                ]
            };
            
            showSolutionContent(tabId, contents[tabId] || contents.basic);
        }
        
        function showSolutionContent(tabId, contentList) {
            const contentContainer = document.getElementById('solution-content');
            contentContainer.innerHTML = `<ul>${contentList.map(item => `<li>${item}</li>`).join('')}</ul>`;
        }
        
        function updateUserIssues() {
            const issues = [];
            
            const skillsData = getSelectedSkills();
            
            skillsData.sound.forEach(level => {
                if (level === 'basic') {
                issues.push('åŸºæœ¬çš„ãªéŸ³ã®ãƒ«ãƒ¼ãƒ«ãŒã‚ã‹ã‚‰ãªã„');
                } else if (level === 'intermediate') {
                issues.push('éŸ³ãŒèãåˆ†ã‘ã‚‰ã‚Œãªã„ã€éŸ³ãŒå›ã‚‰ãªã„');
                } else if (level === 'advanced') {
                issues.push('ã‚¹ãƒ”ãƒ¼ãƒ‰ã«ã¤ã„ã¦ã„ã‘ãªã„ã€é•·ããªã‚‹ã¨ä¿æŒã§ããªã„');
            }
            });
            
            skillsData.text.forEach(level => {
                if (level === 'basic') {
                issues.push('åŸºæœ¬çš„ãªæ–‡ã®ãƒ«ãƒ¼ãƒ«ï¼ˆæ–‡æ³•ï¼‰ãŒã‚ã‹ã‚‰ãªã„');
                } else if (level === 'intermediate') {
                issues.push('æ–‡ç« ã§ç†è§£ã§ããªã„ã€æ–‡ã‚’çµ„ã¿ç«‹ã¦ã‚‰ã‚Œãªã„');
                } else if (level === 'advanced') {
                issues.push('æƒ…å ±é‡ãŒå¤šããªã‚‹ã¨ç†è§£ã§ããªã„/è©±ã›ãªã„');
            }
            });
            
            skillsData.vocabulary.forEach(level => {
                if (level === 'basic') {
                issues.push('åŸºæœ¬çš„ãªå˜èªãŒã‚ã‹ã‚‰ãªã„');
                } else if (level === 'intermediate') {
                issues.push('ã¨ã£ã•ã«ç°¡å˜ãªå˜èªãŒå‡ºã¦ã“ãªã„');
                } else if (level === 'advanced') {
                issues.push('æ–‡è„ˆã«å¿œã˜ãŸè¡¨ç¾ã®ä½¿ã„åˆ†ã‘ãŒã§ããªã„');
            }
            });
            
            // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®èª²é¡Œã‚’è¨­å®š
            if (issues.length === 0) {
                issues.push('éŸ³ãŒèãåˆ†ã‘ã‚‰ã‚Œãªã„ã€éŸ³ãŒå›ã‚‰ãªã„');
                issues.push('æ–‡ç« ã§ç†è§£ã§ããªã„ã€æ–‡ã‚’çµ„ã¿ç«‹ã¦ã‚‰ã‚Œãªã„');
                issues.push('ã¨ã£ã•ã«ç°¡å˜ãªå˜èªãŒå‡ºã¦ã“ãªã„');
            }
            
            const issuesList = document.getElementById('user-issues');
            issuesList.innerHTML = issues.map(issue => `<li>${issue}</li>`).join('');
        }
        
        function updateSkillsNextButton() {
            const nextBtn = document.getElementById('skills-next-btn');
            // æ–°ã—ã„ãƒ‡ãƒ¼ã‚¿æ§‹é€ : skill_level å½¢å¼ã®ã‚­ãƒ¼ã‚’ã‚«ã‚¦ãƒ³ãƒˆ
            const selectedSkills = Object.keys(userSelections).filter(key => 
                key.includes('_') && userSelections[key] && userSelections[key].skill
            );
            const hasSkillSelection = selectedSkills.length > 0;
            
            console.log('=== updateSkillsNextButton ===');
            console.log('Selected skills:', selectedSkills);
            console.log('Has skill selection:', hasSkillSelection);
            console.log('Full userSelections:', userSelections);
            
            // ç¾åœ¨é¸æŠã•ã‚Œã¦ã„ã‚‹è¦ç´ ã‚‚ç¢ºèª
            const selectedElements = document.querySelectorAll('.difficulty-btn.selected');
            console.log('Selected elements count:', selectedElements.length);
            selectedElements.forEach((el, index) => {
                console.log(`Selected element ${index}:`, el.dataset.skill, el.dataset.level);
            });
            
            if (hasSkillSelection) {
                nextBtn.disabled = false;
                nextBtn.style.opacity = '1';
                nextBtn.style.cursor = 'pointer';
                console.log('Next button enabled');
            } else {
                nextBtn.disabled = true;
                nextBtn.style.opacity = '0.5';
                nextBtn.style.cursor = 'not-allowed';
                console.log('Next button disabled');
            }
            console.log('=== End updateSkillsNextButton ===');
        }
        
        function showServiceDetail(service) {
            const detailContent = document.getElementById('service-detail-content');
            
            detailContent.innerHTML = `
                <div class="service-header">
                    <div class="service-logo">${service.logo}</div>
                    <div class="service-info">
                        <h2>${service.name}</h2>
                        <div class="service-price">${service.price}</div>
                    </div>
                </div>
                
                <div class="service-details">
                    <div class="detail-section">
                        <h3>å­¦ç¿’å†…å®¹</h3>
                        <ul class="detail-list">
                            ${service.details["å­¦ç¿’å†…å®¹"].map(item => `<li>${item}</li>`).join('')}
                        </ul>
                    </div>
                    <div class="detail-section">
                        <h3>ç‰¹å¾´</h3>
                        <ul class="detail-list">
                            ${service.details["ç‰¹å¾´"].map(item => `<li>${item}</li>`).join('')}
                        </ul>
                    </div>
                </div>
                
                <div class="cta-section">
                    <h3>ã“ã®ã‚µãƒ¼ãƒ“ã‚¹ã‚’å§‹ã‚ã‚‹</h3>
                    <p>å…¬å¼ã‚µã‚¤ãƒˆã§è©³ç´°ã‚’ç¢ºèªã—ã€ç„¡æ–™ä½“é¨“ã‹ã‚‰å§‹ã‚ã‚‹ã“ã¨ã‚’ãŠå‹§ã‚ã—ã¾ã™ã€‚</p>
                </div>
            `;
            
            // è©³ç´°ãƒšãƒ¼ã‚¸ã«ç§»å‹•
            nextScreen('service-detail');
            
            // URLã‚’ä¿å­˜
            window.currentServiceUrl = service.url;
        }
        
        function visitService() {
            if (window.currentServiceUrl) {
                window.open(window.currentServiceUrl, '_blank');
            }
        }
    </script>
</body>
</html>