<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>英語学習ナビゲーション</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Hiragino Sans', 'Yu Gothic UI', sans-serif;
            line-height: 1.6;
            color: #333;
            background: #f5f5f5;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .screen {
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            margin: 20px 0;
            display: none;
            animation: slideIn 0.5s ease-out;
        }
        
        .screen.active {
            display: block;
        }
        
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .logo {
            color: #2c3e50;
            font-size: 28px;
            font-weight: bold;
            margin-bottom: 10px;
        }
        
        .subtitle {
            color: #666;
            font-size: 16px;
        }
        
        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e9ecef;
            border-radius: 4px;
            overflow: hidden;
            margin: 20px 0;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            transition: width 0.5s ease;
        }
        
        /* 診断画面のスタイル */
        .diagnosis-section {
            margin: 30px 0;
        }
        
        .question {
            font-size: 22px;
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .skill-grid {
            display: grid;
            grid-template-columns: 100px 1fr;
            gap: 20px;
            margin: 30px 0;
        }
        
        .skill-label {
            display: flex;
            align-items: center;
            font-weight: bold;
            color: #495057;
        }
        
        .skill-icon {
            margin-right: 8px;
            font-size: 20px;
        }
        
        .difficulty-options {
            display: flex;
            gap: 10px;
        }
        
        .difficulty-btn {
            flex: 1;
            padding: 15px;
            border: 2px solid #dee2e6;
            border-radius: 12px;
            background: white;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
            font-size: 14px;
        }
        
        .difficulty-btn:hover {
            border-color: #667eea;
            background: #f8f9ff;
        }
        
        .difficulty-btn.selected {
            border-color: #667eea !important;
            background: #667eea !important;
            color: white !important;
        }
        
        .difficulty-btn.selected:hover {
            background: #5a6fd8 !important;
        }
        
        /* ステージ表示 */
        .stage-timeline {
            display: flex;
            justify-content: center;
            align-items: center;
            margin: 40px 0;
            position: relative;
        }
        
        .stage-line {
            position: absolute;
            top: 50%;
            left: 10%;
            right: 10%;
            height: 3px;
            background: #dee2e6;
            z-index: 1;
        }
        
        .stage-item {
            background: #dee2e6;
            color: white;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin: 0 20px;
            position: relative;
            z-index: 2;
            transition: all 0.3s;
        }
        
        .stage-item.current {
            background: #667eea;
            transform: scale(1.2);
            box-shadow: 0 0 20px rgba(102, 126, 234, 0.5);
        }
        
        .stage-item.passed {
            background: #28a745;
        }
        
        /* 問題点と対策 */
        .issues-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }
        
        .issue-card {
            background: #f8f9fa;
            border-left: 4px solid #dc3545;
            padding: 20px;
            border-radius: 8px;
        }
        
        .issue-title {
            font-weight: bold;
            color: #dc3545;
            margin-bottom: 10px;
        }
        
        .solution-card {
            background: #f8f9fa;
            border-left: 4px solid #28a745;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
        }
        
        .solution-title {
            font-weight: bold;
            color: #28a745;
            margin-bottom: 10px;
        }
        
        /* サービス推奨 */
        .services-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }
        
        .service-card {
            background: white;
            border: 2px solid #dee2e6;
            border-radius: 12px;
            padding: 20px;
            transition: all 0.3s;
            cursor: pointer;
        }
        
        .service-card:hover {
            border-color: #667eea;
            transform: translateY(-4px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
        }
        

        
        .service-name {
            font-weight: bold;
            font-size: 18px;
            margin-bottom: 10px;
            color: #2c3e50;
        }
        
        .service-description {
            color: #666;
            font-size: 14px;
            margin-bottom: 15px;
        }
        
        .service-features {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
        }
        
        .feature-tag {
            background: #e3f2fd;
            color: #1976d2;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 11px;
        }
        
        /* 商品詳細ページ */
        .service-detail {
            background: white;
            border-radius: 12px;
            padding: 30px;
            margin: 20px 0;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        
        .service-header {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .service-logo {
            width: 80px;
            height: 80px;
            background: #f8f9fa;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            margin-right: 20px;
        }
        
        .service-info h2 {
            color: #2c3e50;
            margin-bottom: 5px;
        }
        
        .service-price {
            color: #28a745;
            font-weight: bold;
            font-size: 18px;
        }
        
        .service-details {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin: 30px 0;
        }
        
        .detail-section h3 {
            color: #495057;
            margin-bottom: 15px;
            border-bottom: 2px solid #e9ecef;
            padding-bottom: 8px;
        }
        
        .detail-list {
            list-style: none;
        }
        
        .detail-list li {
            padding: 8px 0;
            border-bottom: 1px solid #f8f9fa;
        }
        
        .detail-list li:before {
            content: "✓";
            color: #28a745;
            font-weight: bold;
            margin-right: 10px;
        }
        
        .cta-section {
            text-align: center;
            margin: 30px 0;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 12px;
        }
        
        /* ボタン */
        .btn {
            padding: 15px 30px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            margin: 10px;
        }
        
        .btn-primary {
            background: #667eea;
            color: white;
        }
        
        .btn-primary:hover {
            background: #5a6fd8;
            transform: translateY(-2px);
        }
        
        .btn-primary:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }
        
        .btn-primary:disabled:hover {
            background: #ccc;
            transform: none;
        }
        
        .btn-secondary {
            background: #6c757d;
            color: white;
        }
        
        .btn-back {
            background: #e9ecef;
            color: #495057;
        }
        
        .btn-container {
            text-align: center;
            margin-top: 40px;
        }
        
        .navigation-tabs {
            display: flex;
            justify-content: center;
            margin-bottom: 20px;
        }
        
        .nav-tab {
            padding: 10px 20px;
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .nav-tab:first-child {
            border-radius: 8px 0 0 8px;
        }
        
        .nav-tab:last-child {
            border-radius: 0 8px 8px 0;
        }
        
        .nav-tab.active {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }
        
        /* TOEIC選択ボタン */
        .toeic-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 30px 0;
        }
        
        .toeic-btn {
            background: white;
            border: 2px solid #dee2e6;
            border-radius: 12px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
        }
        
        .toeic-btn:hover {
            border-color: #667eea;
            background: #f8f9ff;
        }
        
        .toeic-btn.selected {
            border-color: #667eea;
            background: #667eea;
            color: white;
        }
        
        .toeic-score {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .toeic-level {
            font-size: 14px;
            margin-bottom: 8px;
            opacity: 0.8;
        }
        
        .toeic-description {
            font-size: 12px;
            opacity: 0.7;
        }
        
        /* モーダルスタイル */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            animation: fadeIn 0.3s ease;
        }
        
        .modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .modal-content {
            background: white;
            border-radius: 15px;
            padding: 30px;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            position: relative;
            animation: slideUp 0.3s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(50px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .modal-close {
            position: absolute;
            top: 15px;
            right: 20px;
            font-size: 24px;
            cursor: pointer;
            color: #999;
            transition: color 0.3s;
        }
        
        .modal-close:hover {
            color: #333;
        }
        
        .modal-title {
            font-size: 20px;
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 15px;
        }
        
        .modal-description {
            color: #666;
            line-height: 1.6;
            margin-bottom: 20px;
        }
        
        .modal-examples {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
        }
        
        .modal-examples h4 {
            color: #495057;
            margin-bottom: 10px;
        }
        
        .modal-examples ul {
            margin-left: 20px;
        }
        
        .modal-examples li {
            margin-bottom: 5px;
            color: #666;
        }
        
        /* 課題詳細ボタン */
        .difficulty-btn {
            position: relative;
        }
        
        .difficulty-btn::after {
            content: "ℹ️";
            position: absolute;
            top: 5px;
            right: 8px;
            font-size: 12px;
            opacity: 0.7;
        }
        
        .difficulty-btn:hover::after {
            opacity: 1;
        }
        
        /* 課題・対策・アプローチのグリッド */
        .challenge-solution-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }
        
        .challenge-solution-card {
            background: white;
            border: 2px solid #e9ecef;
            border-radius: 15px;
            padding: 25px;
            transition: all 0.3s;
            cursor: pointer;
        }
        
        .challenge-solution-card:hover {
            border-color: #667eea;
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
        }
        
        .challenge-solution-card.selected {
            border-color: #667eea;
            background: #f8f9ff;
        }
        
        .challenge-header {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .challenge-icon {
            font-size: 24px;
            margin-right: 10px;
        }
        
        .challenge-title {
            font-size: 18px;
            font-weight: bold;
            color: #2c3e50;
        }
        
        .challenge-description {
            color: #666;
            font-size: 14px;
            margin-bottom: 20px;
            line-height: 1.5;
        }
        
        .solution-section {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
        }
        
        .solution-section-title {
            font-weight: bold;
            color: #495057;
            margin-bottom: 8px;
            font-size: 14px;
        }
        
        .solution-content {
            color: #666;
            font-size: 13px;
            line-height: 1.4;
        }
        
        .approach-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            margin-top: 10px;
        }
        
        .approach-tag {
            background: #e3f2fd;
            color: #1976d2;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- 画面1: 開始画面 -->
        <div class="screen active" id="start-screen">
            <div class="header">
                <div class="logo">🎯 英語学習ナビ</div>
                <div class="subtitle">あなたに最適な英語学習サービスを見つけましょう</div>
            </div>
            
            <div style="text-align: center; margin: 50px 0;">
                <h2>3つの質問で最適なコースを診断</h2>
                <p style="color: #666; margin: 20px 0;">現在の英語レベルと学習目標から、あなたにぴったりのサービスをご提案します</p>
                <div style="margin: 40px 0;">
                    <div style="font-size: 48px; margin-bottom: 20px;">📚</div>
                    <div style="color: #666;">診断時間：約2分</div>
                </div>
            </div>
            
            <div class="btn-container">
                <button class="btn btn-primary" onclick="nextScreen('diagnosis-screen')">診断を開始する</button>
            </div>
        </div>
        
        <!-- 画面2: 診断画面 -->
        <div class="screen" id="diagnosis-screen">
            <div class="header">
                <div class="logo">レベル診断</div>
                <div class="progress-bar">
                    <div class="progress-fill" style="width: 25%"></div>
                </div>
            </div>
            
            <div class="diagnosis-section">
                <div class="question">まず、あなたの現在のTOEICレベルを教えてください</div>
                
                <div class="toeic-options">
                    <div class="toeic-btn" onclick="selectTOEIC(this, 'basic')">
                        <div class="toeic-score">300-600点</div>
                        <div class="toeic-level">基礎レベル</div>
                        <div class="toeic-description">基本的な文法や語彙を学習中</div>
                    </div>
                    <div class="toeic-btn" onclick="selectTOEIC(this, 'intermediate')">
                        <div class="toeic-score">600-750点</div>
                        <div class="toeic-level">中級レベル</div>
                        <div class="toeic-description">日常的な英語は理解できる</div>
                    </div>
                    <div class="toeic-btn" onclick="selectTOEIC(this, 'advanced')">
                        <div class="toeic-score">750点以上</div>
                        <div class="toeic-level">上級レベル</div>
                        <div class="toeic-description">ビジネス英語も理解できる</div>
                    </div>
                    <div class="toeic-btn" onclick="selectTOEIC(this, 'unknown')">
                        <div class="toeic-score">未受験</div>
                        <div class="toeic-level">レベル不明</div>
                        <div class="toeic-description">TOEICを受けたことがない</div>
                    </div>
                </div>
            </div>
            
            <div class="btn-container">
                <button class="btn btn-back" onclick="prevScreen('start-screen')">戻る</button>
                <button class="btn btn-primary" id="toeic-next-btn" onclick="nextScreen('skills-diagnosis')" disabled>次へ</button>
            </div>
        </div>
        
        <!-- 画面2.5: スキル診断画面 -->
        <div class="screen" id="skills-diagnosis">
            <div class="header">
                <div class="logo">スキル診断</div>
                <div class="progress-bar">
                    <div class="progress-fill" style="width: 50%"></div>
                </div>
            </div>
            
            <div class="diagnosis-section">
                <div class="question">現在の英語スキルについて教えてください</div>
                
                <div class="skill-grid">
                    <div class="skill-label">
                        <span class="skill-icon">🎧</span> 音声
                    </div>
                    <div class="difficulty-options">
                        <div class="difficulty-btn" onclick="selectDifficulty(this, 'sound', 'basic')" data-skill="sound" data-level="basic" title="マウスオーバーで詳細表示">
                            基本的なルールが<br>わからない
                        </div>
                        <div class="difficulty-btn" onclick="selectDifficulty(this, 'sound', 'intermediate')" data-skill="sound" data-level="intermediate" title="マウスオーバーで詳細表示">
                            音が聞き分けられない<br>音が回らない
                        </div>
                        <div class="difficulty-btn" onclick="selectDifficulty(this, 'sound', 'advanced')" data-skill="sound" data-level="advanced" title="マウスオーバーで詳細表示">
                            スピードについていけない<br>長くなると保持できない
                        </div>
                    </div>
                    
                    <div class="skill-label">
                        <span class="skill-icon">📝</span> 文章
                    </div>
                    <div class="difficulty-options">
                        <div class="difficulty-btn" onclick="selectDifficulty(this, 'text', 'basic')" data-skill="text" data-level="basic" title="マウスオーバーで詳細表示">
                            基本的な文のルール<br>（文法）がわからない
                        </div>
                        <div class="difficulty-btn" onclick="selectDifficulty(this, 'text', 'intermediate')" data-skill="text" data-level="intermediate" title="マウスオーバーで詳細表示">
                            文章で理解できない<br>文を組み立てられない
                        </div>
                        <div class="difficulty-btn" onclick="selectDifficulty(this, 'text', 'advanced')" data-skill="text" data-level="advanced" title="マウスオーバーで詳細表示">
                            情報量が多くなると<br>理解できない/話せない
                        </div>
                    </div>
                    
                    <div class="skill-label">
                        <span class="skill-icon">📖</span> 語彙
                    </div>
                    <div class="difficulty-options">
                        <div class="difficulty-btn" onclick="selectDifficulty(this, 'vocabulary', 'basic')" data-skill="vocabulary" data-level="basic" title="マウスオーバーで詳細表示">
                            基本的な単語が<br>わからない
                        </div>
                        <div class="difficulty-btn" onclick="selectDifficulty(this, 'vocabulary', 'intermediate')" data-skill="vocabulary" data-level="intermediate" title="マウスオーバーで詳細表示">
                            とっさに簡単な<br>単語が出てこない
                        </div>
                        <div class="difficulty-btn" onclick="selectDifficulty(this, 'vocabulary', 'advanced')" data-skill="vocabulary" data-level="advanced" title="マウスオーバーで詳細表示">
                            文脈に応じた表現の<br>使い分けができない
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="btn-container">
                <button class="btn btn-back" onclick="prevScreen('diagnosis-screen')">戻る</button>
                <button class="btn btn-primary" id="skills-next-btn" onclick="nextScreen('level-result')" disabled>次へ</button>
            </div>
        </div>
        
        <!-- 画面3: レベル判定結果 -->
        <div class="screen" id="level-result">
            <div class="header">
                <div class="logo">あなたのレベル診断結果</div>
                <div class="progress-bar">
                    <div class="progress-fill" style="width: 66%"></div>
                </div>
            </div>
            
            <div class="stage-timeline" id="stage-timeline">
                <div class="stage-line"></div>
                <div class="stage-item" data-level="A1">A1</div>
                <div class="stage-item" data-level="A2">A2</div>
                <div class="stage-item" data-level="B1">B1</div>
                <div class="stage-item" data-level="B2">B2</div>
                <div class="stage-item" data-level="C1">C1</div>
                <div class="stage-item" data-level="C2">C2</div>
            </div>
            
            <div style="text-align: center; margin: 30px 0;">
                <h2 style="color: #667eea;">あなたの現在レベル：<span id="user-level">A2</span></h2>
                <p style="color: #666;" id="level-description">基礎語彙がある程度理解できるレベル（TOEIC 500-600）</p>
            </div>
            
            <div class="challenge-solution-grid" id="challenge-solution-grid">
                <!-- 課題・対策・アプローチがセットで表示される -->
            </div>
            
            <div class="btn-container">
                <button class="btn btn-back" onclick="prevScreen('diagnosis-screen')">戻る</button>
                <button class="btn btn-primary" onclick="nextScreen('service-recommendation')">サービスを見る</button>
            </div>
        </div>
        
        <!-- 画面4: サービス推奨 -->
        <div class="screen" id="service-recommendation">
            <div class="header">
                <div class="logo">あなたにおすすめのサービス</div>
                <div class="progress-bar">
                    <div class="progress-fill" style="width: 100%"></div>
                </div>
            </div>
            
            <div style="text-align: center; margin: 30px 0;">
                <h2 id="recommendation-title">学習プラン</h2>
                <p style="color: #666;" id="recommendation-subtitle">あなたのレベルに合わせた最適なサービスをご提案</p>
            </div>
            
            <div class="services-grid" id="services-container">
                <!-- サービスカードは動的に生成 -->
            </div>
            
            <div class="btn-container">
                <button class="btn btn-back" onclick="prevScreen('level-result')">戻る</button>
                <button class="btn btn-primary" onclick="nextScreen('start-screen')">最初に戻る</button>
            </div>
        </div>
        
        <!-- 商品詳細ページ -->
        <div class="screen" id="service-detail">
            <div class="header">
                <div class="logo">サービス詳細</div>
            </div>
            
            <div class="service-detail" id="service-detail-content">
                <!-- 詳細内容は動的に生成 -->
            </div>
            
            <div class="btn-container">
                <button class="btn btn-back" onclick="prevScreen('service-recommendation')">戻る</button>
                <button class="btn btn-primary" onclick="visitService()">公式サイトへ</button>
            </div>
        </div>
    </div>
    
    <!-- 課題詳細モーダル -->
    <div class="modal" id="challenge-modal">
        <div class="modal-content">
            <span class="modal-close" onclick="closeChallengeModal()">&times;</span>
            <div class="modal-title" id="modal-title">課題詳細</div>
            <div class="modal-description" id="modal-description">
                <!-- 課題の詳細説明がここに表示されます -->
            </div>
            <div class="modal-examples" id="modal-examples">
                <!-- 具体例がここに表示されます -->
            </div>
        </div>
    </div>
    
    <script>
        // ユーザーの選択を保存
        let userSelections = {
            toeic: null,
            sound: null,
            text: null,
            vocabulary: null
        };
        
        // TOEIC選択機能
        function selectTOEIC(element, level) {
            // 既に選択されている場合は選択を解除
            if (element.classList.contains('selected')) {
                element.classList.remove('selected');
                userSelections.toeic = null;
            } else {
                // 他のボタンの選択を解除
                const siblings = element.parentElement.children;
                for (let sibling of siblings) {
                    sibling.classList.remove('selected');
                }
                
                // 新しい選択を追加
                element.classList.add('selected');
                userSelections.toeic = level;
            }
            
            // 次へボタンの有効/無効を更新
            updateTOEICNextButton();
        }
        
        function updateTOEICNextButton() {
            const nextBtn = document.getElementById('toeic-next-btn');
            
            if (userSelections.toeic) {
                nextBtn.disabled = false;
                nextBtn.style.opacity = '1';
                nextBtn.style.cursor = 'pointer';
            } else {
                nextBtn.disabled = true;
                nextBtn.style.opacity = '0.5';
                nextBtn.style.cursor = 'not-allowed';
            }
        }
        
        // 課題詳細データ
        const challengeDetails = {
            sound: {
                basic: {
                    title: "音声 - 基本的なルールがわからない",
                    description: "英語の音のルール（発音記号、音の変化、リズムなど）の基礎知識が不足している状態です。",
                    examples: [
                        "発音記号が読めない",
                        "子音と母音の区別ができない",
                        "単語のアクセントがわからない",
                        "リエゾン（音の連結）が理解できない",
                        "強勢とリズムがつかめない"
                    ]
                },
                intermediate: {
                    title: "音声 - 音が聞き分けられない・音が回らない",
                    description: "基本的な音のルールは理解しているが、実際の聞き取りや発話で困難を感じている状態です。",
                    examples: [
                        "LとRの区別ができない",
                        "THの音が出せない",
                        "早口になると聞き取れない",
                        "自分で発音しようとすると舌が回らない",
                        "ネイティブの発音と自分の発音が違う"
                    ]
                },
                advanced: {
                    title: "音声 - スピードについていけない・長くなると保持できない",
                    description: "個々の音は理解できるが、自然なスピードや長い文章になると処理が追いつかない状態です。",
                    examples: [
                        "映画やドラマの英語が早すぎて聞き取れない",
                        "長い文章の途中で内容を忘れてしまう",
                        "会議やプレゼンテーションについていけない",
                        "電話での会話が困難",
                        "複数人の会話に入れない"
                    ]
                }
            },
            text: {
                basic: {
                    title: "文章 - 基本的な文のルール（文法）がわからない",
                    description: "英語の基本的な文法構造や語順ルールが理解できていない状態です。",
                    examples: [
                        "主語・動詞・目的語の順番がわからない",
                        "時制（現在・過去・未来）が使い分けられない",
                        "疑問文・否定文の作り方がわからない",
                        "前置詞の使い方がわからない",
                        "単数・複数の概念が曖昧"
                    ]
                },
                intermediate: {
                    title: "文章 - 文章で理解できない・文を組み立てられない",
                    description: "基本文法は理解しているが、実際の文章理解や作文で困難を感じている状態です。",
                    examples: [
                        "長い文章の構造が把握できない",
                        "関係代名詞の文が理解できない",
                        "自分の言いたいことを英語で表現できない",
                        "文章を読むのに時間がかかりすぎる",
                        "複雑な文法構造が使えない"
                    ]
                },
                advanced: {
                    title: "文章 - 情報量が多くなると理解できない・話せない",
                    description: "基本的な文章は理解できるが、複雑で情報量の多い内容になると処理が困難な状態です。",
                    examples: [
                        "論文や専門文書が読めない",
                        "ビジネス文書の作成ができない",
                        "プレゼンテーションで論理的に話せない",
                        "ディスカッションで意見を整理して伝えられない",
                        "ニュアンスや含意が理解できない"
                    ]
                }
            },
            vocabulary: {
                basic: {
                    title: "語彙 - 基本的な単語がわからない",
                    description: "日常生活や基本的なコミュニケーションに必要な語彙が不足している状態です。",
                    examples: [
                        "中学レベルの基本単語がわからない",
                        "数字や曜日、月が英語で言えない",
                        "家族や職業の単語がわからない",
                        "基本的な動詞（eat, drink, go等）が使えない",
                        "色や形の単語がわからない"
                    ]
                },
                intermediate: {
                    title: "語彙 - とっさに簡単な単語が出てこない",
                    description: "語彙は知っているが、会話や作文で適切な単語を瞬時に思い出せない状態です。",
                    examples: [
                        "知っている単語なのに会話で出てこない",
                        "日本語では簡単に言えることが英語で表現できない",
                        "単語を思い出すのに時間がかかる",
                        "同じ単語ばかり使ってしまう",
                        "類義語の使い分けができない"
                    ]
                },
                advanced: {
                    title: "語彙 - 文脈に応じた表現の使い分けができない",
                    description: "豊富な語彙は持っているが、場面や文脈に応じた適切な表現選択ができない状態です。",
                    examples: [
                        "フォーマル・カジュアルの使い分けができない",
                        "ビジネス場面での適切な表現がわからない",
                        "文化的なニュアンスが理解できない",
                        "専門用語と一般用語の使い分けができない",
                        "相手に応じた敬語レベルの調整ができない"
                    ]
                }
            }
        };
        
        // モーダル表示機能
        let modalTimeout = null;
        
        function showChallengeModal(skill, level) {
            // 既存のタイムアウトをクリア
            if (modalTimeout) {
                clearTimeout(modalTimeout);
            }
            
            // 少し遅延してモーダルを表示（誤動作を防ぐため）
            modalTimeout = setTimeout(() => {
                const modal = document.getElementById('challenge-modal');
                const title = document.getElementById('modal-title');
                const description = document.getElementById('modal-description');
                const examples = document.getElementById('modal-examples');
                
                if (challengeDetails[skill] && challengeDetails[skill][level]) {
                    const data = challengeDetails[skill][level];
                    
                    title.textContent = data.title;
                    description.textContent = data.description;
                    
                    examples.innerHTML = `
                        <h4>具体例：</h4>
                        <ul>
                            ${data.examples.map(example => `<li>${example}</li>`).join('')}
                        </ul>
                    `;
                    
                    modal.classList.add('active');
                }
            }, 300);
        }
        
        function closeChallengeModal() {
            // タイムアウトをクリア
            if (modalTimeout) {
                clearTimeout(modalTimeout);
                modalTimeout = null;
            }
            
            const modal = document.getElementById('challenge-modal');
            modal.classList.remove('active');
        }
        
        // モーダル外クリックで閉じる
        window.onclick = function(event) {
            const modal = document.getElementById('challenge-modal');
            if (event.target === modal) {
                closeChallengeModal();
            }
        }
        
        // ページ読み込み後にイベントリスナーを設定
        document.addEventListener('DOMContentLoaded', function() {
            setupEventListeners();
        });
        
        function setupEventListeners() {
            // すべての difficulty-btn にマウスオーバーイベントを追加
            const difficultyBtns = document.querySelectorAll('.difficulty-btn');
            
            difficultyBtns.forEach(btn => {
                const skill = btn.getAttribute('data-skill');
                const level = btn.getAttribute('data-level');
                
                if (skill && level) {
                    btn.addEventListener('mouseenter', function() {
                        showChallengeModal(skill, level);
                    });
                    
                    btn.addEventListener('mouseleave', function() {
                        closeChallengeModal();
                    });
                }
            });
        }
        
        // 課題・対策・アプローチカードを更新
        function updateChallengeSolutionCards() {
            const container = document.getElementById('challenge-solution-grid');
            const challengeSolutions = [];
            
            // 選択された課題に基づいてカードを生成
            if (userSelections.sound) {
                challengeSolutions.push(createChallengeSolutionCard('sound', userSelections.sound));
            }
            if (userSelections.text) {
                challengeSolutions.push(createChallengeSolutionCard('text', userSelections.text));
            }
            if (userSelections.vocabulary) {
                challengeSolutions.push(createChallengeSolutionCard('vocabulary', userSelections.vocabulary));
            }
            
            container.innerHTML = challengeSolutions.join('');
        }
        
        function createChallengeSolutionCard(skill, level) {
            const skillData = {
                sound: { icon: '🎧', name: '音声' },
                text: { icon: '📝', name: '文章' },
                vocabulary: { icon: '📖', name: '語彙' }
            };
            
            const challengeData = challengeDetails[skill][level];
            const solutions = getSolutionForChallenge(skill, level);
            
            return `
                <div class="challenge-solution-card" onclick="selectChallengeSolution('${skill}', '${level}')">
                    <div class="challenge-header">
                        <div class="challenge-icon">${skillData[skill].icon}</div>
                        <div class="challenge-title">${skillData[skill].name}の課題</div>
                    </div>
                    <div class="challenge-description">${challengeData.title.split(' - ')[1]}</div>
                    
                    <div class="solution-section">
                        <div class="solution-section-title">🎯 対策</div>
                        <div class="solution-content">${solutions.strategy}</div>
                    </div>
                    
                    <div class="solution-section">
                        <div class="solution-section-title">📚 アプローチ</div>
                        <div class="solution-content">${solutions.approach}</div>
                        <div class="approach-tags">
                            ${solutions.methods.map(method => `<span class="approach-tag">${method}</span>`).join('')}
                        </div>
                    </div>
                </div>
            `;
        }
        
        function getSolutionForChallenge(skill, level) {
            const solutions = {
                sound: {
                    basic: {
                        strategy: "音のルールを基礎から学習し、発音の基本を身につける",
                        approach: "発音記号の学習、基本的な音の練習、アクセント・リズムの習得",
                        methods: ["発音記号学習", "音読練習", "基礎トレーニング"]
                    },
                    intermediate: {
                        strategy: "音を再現できる（発話できる）ことがゴール",
                        approach: "音読/シャドーイング（レベルに合わせた速さ）、発音矯正トレーニング",
                        methods: ["シャドーイング", "音読トレーニング", "発音矯正"]
                    },
                    advanced: {
                        strategy: "自然なスピードでの音声処理能力を向上させる",
                        approach: "高速音声への慣れ、長文リスニング、実践的な会話練習",
                        methods: ["高速シャドーイング", "実践会話", "長文リスニング"]
                    }
                },
                text: {
                    basic: {
                        strategy: "基本的な文法ルールを体系的に学習する",
                        approach: "中学・高校レベルの文法復習、基本文型の習得",
                        methods: ["基礎文法", "文型練習", "例文暗記"]
                    },
                    intermediate: {
                        strategy: "とにかく英語の文章をクイックに組むこと",
                        approach: "瞬間英作文、カランメソッドなど、英作文系エクササイズ",
                        methods: ["瞬間英作文", "カランメソッド", "文構造練習"]
                    },
                    advanced: {
                        strategy: "クイックに構造化すること",
                        approach: "文脈に合わせた表現の選定、長い文章の多聴多読",
                        methods: ["構造化練習", "多聴多読", "表現選定"]
                    }
                },
                vocabulary: {
                    basic: {
                        strategy: "基本語彙を着実に増やし、定着させる",
                        approach: "頻出単語の暗記、基本語彙の反復学習",
                        methods: ["基本語彙", "反復学習", "語彙テスト"]
                    },
                    intermediate: {
                        strategy: "語彙の瞬発力を向上させる",
                        approach: "語彙の使い分け練習、瞬発的な語彙想起トレーニング",
                        methods: ["語彙想起", "使い分け", "実践練習"]
                    },
                    advanced: {
                        strategy: "文脈に応じた適切な表現を選択できるようになる",
                        approach: "ニュアンスの理解、場面別表現の習得、実践的な使用練習",
                        methods: ["ニュアンス学習", "場面別表現", "実践使用"]
                    }
                }
            };
            
            return solutions[skill][level];
        }
        
        // 課題・対策カードの選択
        let selectedChallenge = null;
        
        function selectChallengeSolution(skill, level) {
            // 既存の選択を解除
            document.querySelectorAll('.challenge-solution-card').forEach(card => {
                card.classList.remove('selected');
            });
            
            // 新しい選択を追加
            event.currentTarget.classList.add('selected');
            selectedChallenge = { skill, level };
        }
        
        // 選択された課題に基づいてサービスを絞り込み
        function getFilteredServices() {
            if (!selectedChallenge) {
                return [];
            }
            
            const { skill, level } = selectedChallenge;
            const filteredServices = [];
            
            // 音声の課題の場合
            if (skill === 'sound') {
                if (level === 'basic') {
                    // 基礎レベル：基礎固めサービス
                    filteredServices.push(...services.basic);
                } else if (level === 'intermediate' || level === 'advanced') {
                    // 中級・上級レベル：音読トレーニング系
                    filteredServices.push(...services.selfTraining.audioTraining);
                }
            }
            
            // 文章の課題の場合
            if (skill === 'text') {
                if (level === 'basic') {
                    // 基礎レベル：基礎固めサービス
                    filteredServices.push(...services.basic);
                } else if (level === 'intermediate') {
                    // 中級レベル：英作文系 + カランメソッド
                    filteredServices.push(...services.selfTraining.writingTraining);
                    filteredServices.push(...services.novaAlternative.callan);
                } else if (level === 'advanced') {
                    // 上級レベル：マーケットリーダー
                    filteredServices.push(...services.novaAlternative.marketLeader);
                    filteredServices.push(...services.advanced);
                }
            }
            
            // 語彙の課題の場合
            if (skill === 'vocabulary') {
                if (level === 'basic') {
                    // 基礎レベル：基礎固めサービス
                    filteredServices.push(...services.basic);
                } else if (level === 'intermediate') {
                    // 中級レベル：AIツール + 英作文系
                    filteredServices.push(...services.selfTraining.aiTools);
                    filteredServices.push(...services.selfTraining.writingTraining);
                } else if (level === 'advanced') {
                    // 上級レベル：マーケットリーダー + 上級サービス
                    filteredServices.push(...services.novaAlternative.marketLeader);
                    filteredServices.push(...services.advanced);
                }
            }
            
            // 重複を除去
            const uniqueServices = filteredServices.filter((service, index, self) => 
                index === self.findIndex(s => s.name === service.name)
            );
            
            return uniqueServices;
        }
        
        // サービスデータ（画像を参考に拡充）
        const services = {
            // 自主トレーニング系
            selfTraining: {
                audioTraining: [
                    {
                        name: "SHADOTEN",
                        description: "シャドーイングに特化した学習アプリ",
                        features: ["シャドーイング", "発音", "音声"],

                        price: "月額980円",
                        logo: "🎧",
                        category: "音読トレーニング系",
                        approach: "自主トレーニング",
                        details: {
                            "学習内容": ["シャドーイング練習", "発音矯正", "音声認識", "リズム練習"],
                            "特徴": ["シャドーイング特化", "音声認識機能", "レベル別教材", "進捗管理"]
                        },
                        url: "https://shadoten.com/"
                    },
                    {
                        name: "Shadowing Buddy",
                        description: "シャドーイング練習のパートナー",
                        features: ["シャドーイング", "発音", "練習"],

                        price: "月額1,480円",
                        logo: "🎤",
                        category: "音読トレーニング系",
                        approach: "自主トレーニング",
                        details: {
                            "学習内容": ["シャドーイング練習", "発音矯正", "音声録音", "フィードバック"],
                            "特徴": ["専用シャドーイング機能", "音声録音・再生", "発音評価", "練習記録"]
                        },
                        url: "https://shadowing-buddy.com/"
                    },
                    {
                        name: "GOSAPO 音読トレーニング",
                        description: "音読に特化したトレーニング",
                        features: ["音読", "発音", "トレーニング"],

                        price: "月額3,980円",
                        logo: "📖",
                        category: "音読トレーニング系",
                        approach: "自主トレーニング",
                        details: {
                            "学習内容": ["音読トレーニング", "発音矯正", "リズム練習", "音声録音"],
                            "特徴": ["音読特化", "科学的なアプローチ", "個人指導", "成果保証"]
                        },
                        url: "https://gosapo.jp/"
                    }
                ],
                writingTraining: [
                    {
                        name: "SUPIFUL",
                        description: "スピーキングに特化した学習",
                        features: ["スピーキング", "英作文", "練習"],

                        price: "月額2,980円",
                        logo: "🗣️",
                        category: "英作文系",
                        approach: "自主トレーニング",
                        details: {
                            "学習内容": ["スピーキング練習", "英作文", "発音練習", "会話練習"],
                            "特徴": ["スピーキング特化", "実践的な練習", "音声認識", "フィードバック"]
                        },
                        url: "https://supiful.com/"
                    },
                    {
                        name: "TOEIC S&W対策アプリ",
                        description: "TOEIC Speaking & Writing 対策",
                        features: ["TOEIC", "スピーキング", "ライティング"],

                        price: "月額2,480円",
                        logo: "📝",
                        category: "英作文系",
                        approach: "自主トレーニング",
                        details: {
                            "学習内容": ["TOEIC S&W対策", "スピーキング練習", "ライティング練習", "模擬試験"],
                            "特徴": ["TOEIC特化", "本番形式の練習", "スコア予測", "弱点分析"]
                        },
                        url: "https://toeic-sw.com/"
                    },
                    {
                        name: "VERSANT対策アプリ",
                        description: "VERSANT Speaking Test 対策",
                        features: ["VERSANT", "スピーキング", "発話流暢性"],

                        price: "月額1,980円",
                        logo: "🎯",
                        category: "英作文系",
                        approach: "自主トレーニング",
                        details: {
                            "学習内容": ["VERSANT対策", "発話流暢性", "語彙力強化", "文構造練習"],
                            "特徴": ["VERSANT特化", "AI評価", "即座のフィードバック", "弱点分析"]
                        },
                        url: "https://versant-prep.com/"
                    }
                ],
                aiTools: [
                    {
                        name: "Speak",
                        description: "スピーキング特化の学習アプリ",
                        features: ["スピーキング", "AI", "練習"],

                        price: "月額1,980円",
                        logo: "🤖",
                        category: "AIツール",
                        approach: "自主トレーニング",
                        details: {
                            "学習内容": ["スピーキング練習", "AIとの会話", "発音練習", "語彙学習"],
                            "特徴": ["AIとの会話練習", "音声認識", "発音評価", "レベル別教材"]
                        },
                        url: "https://speak.com/"
                    },
                    {
                        name: "AI英会話 スピークバディ",
                        description: "AIを使った基礎英会話練習",
                        features: ["AI", "基礎", "24時間対応"],

                        price: "月額3,980円",
                        logo: "🤖",
                        category: "AIツール",
                        approach: "自主トレーニング",
                        details: {
                            "学習内容": ["AIとの英会話練習", "基礎文法学習", "発音練習", "語彙強化"],
                            "特徴": ["24時間いつでも練習可能", "AIによる発音評価", "レベル別カリキュラム", "進捗管理機能"]
                        },
                        url: "https://speak-buddy.com/"
                    },
                    {
                        name: "abceed",
                        description: "TOEIC対策と基礎固めの両立が可能",
                        features: ["TOEIC", "基礎対策", "アプリ学習"],

                        price: "月額1,980円",
                        logo: "📚",
                        category: "AIツール",
                        approach: "自主トレーニング",
                        details: {
                            "学習内容": ["TOEIC形式の問題演習", "基礎文法の復習", "語彙力強化", "リスニング練習"],
                            "特徴": ["TOEICスコア予測機能", "弱点分析機能", "豊富な問題数", "音声付き解説"]
                        },
                        url: "https://abceed.com/"
                    }
                ],
                eLearning: [
                    {
                        name: "パタプライングリッシュ",
                        description: "パタプラ（パターンプラクティス）特化",
                        features: ["文法", "パターン練習", "反復学習"],

                        price: "月額2,480円",
                        logo: "🔄",
                        category: "eラーニング",
                        approach: "自主トレーニング",
                        details: {
                            "学習内容": ["パターンプラクティス", "文法パターン習得", "反復練習", "自動化トレーニング"],
                            "特徴": ["パターン特化", "科学的アプローチ", "段階的学習", "効果測定"]
                        },
                        url: "https://patapura.com/"
                    }
                ]
            },
            // NOVA代替
            novaAlternative: {
                callan: [
                    {
                        name: "NativeCamp.",
                        description: "瞬間英作文に特化したレッスン",
                        features: ["瞬間英作文", "英会話", "無制限"],

                        price: "月額6,480円",
                        logo: "🎯",
                        category: "カランメソッド",
                        approach: "NOVA代替",
                        details: {
                            "学習内容": ["瞬間英作文練習", "カランメソッド実践", "日常会話練習", "発音矯正"],
                            "特徴": ["無制限レッスン", "予約不要で即座にレッスン", "多国籍講師", "アプリで簡単操作"]
                        },
                        url: "https://nativecamp.net/"
                    },
                    {
                        name: "QQ English",
                        description: "カランメソッド特化の英会話",
                        features: ["カランメソッド", "英会話", "フィリピン"],

                        price: "月額5,980円",
                        logo: "💬",
                        category: "カランメソッド",
                        approach: "NOVA代替",
                        details: {
                            "学習内容": ["カランメソッド実践", "瞬間英作文", "日常会話", "文法練習"],
                            "特徴": ["カランメソッド特化", "フィリピン講師", "24時間対応", "レベル別教材"]
                        },
                        url: "https://qqenglish.com/"
                    }
                ],
                marketLeader: [
                    {
                        name: "Bizmates",
                        description: "ビジネス英語に特化した上級者向けサービス",
                        features: ["ビジネス英語", "上級者向け", "専門コース"],

                        price: "月額15,000円〜",
                        logo: "💼",
                        category: "マーケットリーダー",
                        approach: "NOVA代替",
                        details: {
                            "学習内容": ["ビジネス英語", "プレゼンテーション", "交渉英語", "専門分野英語"],
                            "特徴": ["ビジネス特化", "実践的な内容", "専門講師", "企業研修対応"]
                        },
                        url: "https://www.bizmates.jp/"
                    },
                    {
                        name: "DMMビジネスコース",
                        description: "DMM英会話のビジネス特化コース",
                        features: ["ビジネス英語", "DMM", "専門コース"],

                        price: "月額8,980円〜",
                        logo: "💼",
                        category: "マーケットリーダー",
                        approach: "NOVA代替",
                        details: {
                            "学習内容": ["ビジネス英会話", "プレゼンテーション", "会議英語", "メール作成"],
                            "特徴": ["ビジネス特化", "豊富な教材", "多国籍講師", "24時間対応"]
                        },
                        url: "https://eikaiwa.dmm.com/business/"
                    }
                ]
            },
            basic: [
                {
                    name: "スタディサプリ ENGLISH",
                    description: "音のルール、文章のルール、基本的な単語など、中学/高校のおさらいが中心",
                    features: ["発音", "文法", "語彙", "自学習向け"],

                    price: "月額1,980円",
                    logo: "📱",
                    category: "基礎対策",
                    details: {
                        "学習内容": [
                            "中学・高校レベルの基礎文法",
                            "基本単語・熟語の習得",
                            "発音の基本ルール",
                            "TOEIC対策問題"
                        ],
                        "特徴": [
                            "いつでもどこでも学習可能",
                            "レベル別の学習プラン",
                            "音声付きで発音練習",
                            "進捗管理機能"
                        ]
                    },
                    url: "https://eigosapuri.jp/"
                },
                {
                    name: "abceed",
                    description: "TOEIC対策と基礎固めの両立が可能",
                    features: ["TOEIC", "基礎対策", "アプリ学習"],

                    price: "月額1,980円",
                    logo: "📚",
                    category: "基礎対策",
                    details: {
                        "学習内容": [
                            "TOEIC形式の問題演習",
                            "基礎文法の復習",
                            "語彙力強化",
                            "リスニング練習"
                        ],
                        "特徴": [
                            "TOEICスコア予測機能",
                            "弱点分析機能",
                            "豊富な問題数",
                            "音声付き解説"
                        ]
                    },
                    url: "https://abceed.com/"
                },
                {
                    name: "DMM英会話",
                    description: "基礎から始める英会話レッスン",
                    features: ["英会話", "基礎", "フィリピン講師"],

                    price: "月額6,480円〜",
                    logo: "💬",
                    category: "基礎対策",
                    details: {
                        "学習内容": [
                            "基礎英会話レッスン",
                            "日常会話練習",
                            "発音矯正",
                            "文法基礎"
                        ],
                        "特徴": [
                            "24時間レッスン可能",
                            "フィリピン講師中心",
                            "豊富な教材",
                            "レベル別カリキュラム"
                        ]
                    },
                    url: "https://eikaiwa.dmm.com/"
                },
                {
                    name: "AI英会話 スピークバディ",
                    description: "AIを使った基礎英会話練習",
                    features: ["AI", "基礎", "24時間対応"],

                    price: "月額3,980円",
                    logo: "🤖",
                    category: "基礎対策",
                    details: {
                        "学習内容": [
                            "AIとの英会話練習",
                            "基礎文法学習",
                            "発音練習",
                            "語彙強化"
                        ],
                        "特徴": [
                            "24時間いつでも練習可能",
                            "AIによる発音評価",
                            "レベル別カリキュラム",
                            "進捗管理機能"
                        ]
                    },
                    url: "https://speak-buddy.com/"
                },
                {
                    name: "cooori",
                    description: "世界に向けた英語力を身につける",
                    features: ["世界対応", "基礎", "コミュニケーション"],

                    price: "月額4,980円",
                    logo: "🌏",
                    category: "基礎対策",
                    details: {
                        "学習内容": [
                            "基礎英語コミュニケーション",
                            "文化理解",
                            "実践的な英語",
                            "グローバル対応"
                        ],
                        "特徴": [
                            "多国籍講師",
                            "文化理解重視",
                            "実践的な内容",
                            "グローバル視点"
                        ]
                    },
                    url: "https://cooori.com/"
                }
            ],
            sound: [
                {
                    name: "SHADOTEN",
                    description: "シャドーイングに特化した学習アプリ",
                    features: ["シャドーイング", "発音", "音声"],

                    price: "月額980円",
                    logo: "🎧",
                    category: "音読トレーニング系",
                    approach: "自主トレーニング",
                    details: {
                        "学習内容": [
                            "シャドーイング練習",
                            "発音矯正",
                            "音声認識",
                            "リズム練習"
                        ],
                        "特徴": [
                            "シャドーイング特化",
                            "音声認識機能",
                            "レベル別教材",
                            "進捗管理"
                        ]
                    },
                    url: "https://shadoten.com/"
                },
                {
                    name: "Shadowing Buddy",
                    description: "シャドーイング練習のパートナー",
                    features: ["シャドーイング", "発音", "練習"],

                    price: "月額1,480円",
                    logo: "🎤",
                    category: "音の対策",
                    details: {
                        "学習内容": [
                            "シャドーイング練習",
                            "発音矯正",
                            "音声録音",
                            "フィードバック"
                        ],
                        "特徴": [
                            "専用シャドーイング機能",
                            "音声録音・再生",
                            "発音評価",
                            "練習記録"
                        ]
                    },
                    url: "https://shadowing-buddy.com/"
                },
                {
                    name: "EnglishCentral",
                    description: "動画を使った発音練習",
                    features: ["動画", "発音", "リスニング"],

                    price: "月額2,980円",
                    logo: "🎬",
                    category: "音の対策",
                    details: {
                        "学習内容": [
                            "動画を使った発音練習",
                            "リスニング強化",
                            "音声認識",
                            "発音矯正"
                        ],
                        "特徴": [
                            "豊富な動画コンテンツ",
                            "音声認識機能",
                            "発音評価",
                            "レベル別教材"
                        ]
                    },
                    url: "https://www.englishcentral.com/"
                },
                {
                    name: "GOSAPO 音読トレーニング",
                    description: "音読に特化したトレーニング",
                    features: ["音読", "発音", "トレーニング"],

                    price: "月額3,980円",
                    logo: "📖",
                    category: "音の対策",
                    details: {
                        "学習内容": [
                            "音読トレーニング",
                            "発音矯正",
                            "リズム練習",
                            "音声録音"
                        ],
                        "特徴": [
                            "音読特化",
                            "科学的なアプローチ",
                            "個人指導",
                            "成果保証"
                        ]
                    },
                    url: "https://gosapo.jp/"
                },
                {
                    name: "WiLLies English",
                    description: "ウィリーズ英語塾の音声特化コース",
                    features: ["音声", "発音", "塾"],

                    price: "月額8,980円",
                    logo: "🎓",
                    category: "音の対策",
                    details: {
                        "学習内容": [
                            "発音矯正",
                            "音声練習",
                            "シャドーイング",
                            "個人指導"
                        ],
                        "特徴": [
                            "専門塾での指導",
                            "個人指導",
                            "発音特化",
                            "成果重視"
                        ]
                    },
                    url: "https://willies-english.com/"
                },
                {
                    name: "PROGRIT",
                    description: "音声に特化したコーチング",
                    features: ["コーチング", "音声", "個人指導"],

                    price: "月額19,800円",
                    logo: "🎯",
                    category: "音の対策",
                    details: {
                        "学習内容": [
                            "音声コーチング",
                            "発音矯正",
                            "個人指導",
                            "成果管理"
                        ],
                        "特徴": [
                            "専任コーチ",
                            "個人指導",
                            "成果保証",
                            "科学的アプローチ"
                        ]
                    },
                    url: "https://progrit.co.jp/"
                },
                {
                    name: "TEPPEN ENGLISH",
                    description: "音声特化の英語学習",
                    features: ["音声", "発音", "学習"],

                    price: "月額4,980円",
                    logo: "🏔️",
                    category: "音の対策",
                    details: {
                        "学習内容": [
                            "音声学習",
                            "発音練習",
                            "リスニング",
                            "音声認識"
                        ],
                        "特徴": [
                            "音声特化",
                            "最新技術活用",
                            "個人対応",
                            "効果測定"
                        ]
                    },
                    url: "https://teppen-english.com/"
                }
            ],
            grammar: [
                {
                    name: "NativeCamp.",
                    description: "瞬間英作文に特化したレッスン",
                    features: ["瞬間英作文", "英会話", "無制限"],

                    price: "月額6,480円",
                    logo: "🎯",
                    category: "短い文章と語彙の対策",
                    details: {
                        "学習内容": [
                            "瞬間英作文練習",
                            "カランメソッド実践",
                            "日常会話練習",
                            "発音矯正"
                        ],
                        "特徴": [
                            "無制限レッスン",
                            "予約不要で即座にレッスン",
                            "多国籍講師",
                            "アプリで簡単操作"
                        ]
                    },
                    url: "https://nativecamp.net/"
                },
                {
                    name: "QQ English",
                    description: "カランメソッド特化の英会話",
                    features: ["カランメソッド", "英会話", "フィリピン"],

                    price: "月額5,980円",
                    logo: "💬",
                    category: "短い文章と語彙の対策",
                    details: {
                        "学習内容": [
                            "カランメソッド実践",
                            "瞬間英作文",
                            "日常会話",
                            "文法練習"
                        ],
                        "特徴": [
                            "カランメソッド特化",
                            "フィリピン講師",
                            "24時間対応",
                            "レベル別教材"
                        ]
                    },
                    url: "https://qqenglish.com/"
                },
                {
                    name: "PATAPURA",
                    description: "パタプライングリッシュの文法特化コース",
                    features: ["文法", "英作文", "学習"],

                    price: "月額3,980円",
                    logo: "📝",
                    category: "短い文章と語彙の対策",
                    details: {
                        "学習内容": [
                            "文法学習",
                            "英作文練習",
                            "語彙強化",
                            "文構造理解"
                        ],
                        "特徴": [
                            "文法特化",
                            "体系的学習",
                            "練習問題豊富",
                            "理解度チェック"
                        ]
                    },
                    url: "https://patapura.com/"
                },
                {
                    name: "SUPIFUL",
                    description: "スピーキングに特化した学習",
                    features: ["スピーキング", "英作文", "練習"],

                    price: "月額2,980円",
                    logo: "🗣️",
                    category: "短い文章と語彙の対策",
                    details: {
                        "学習内容": [
                            "スピーキング練習",
                            "英作文",
                            "発音練習",
                            "会話練習"
                        ],
                        "特徴": [
                            "スピーキング特化",
                            "実践的な練習",
                            "音声認識",
                            "フィードバック"
                        ]
                    },
                    url: "https://supiful.com/"
                },
                {
                    name: "GOSAPO AI添削",
                    description: "AIによる英作文添削",
                    features: ["AI添削", "英作文", "文法"],

                    price: "月額1,980円",
                    logo: "✏️",
                    category: "短い文章と語彙の対策",
                    details: {
                        "学習内容": [
                            "AI英作文添削",
                            "文法チェック",
                            "表現改善",
                            "語彙提案"
                        ],
                        "特徴": [
                            "AIによる即座の添削",
                            "詳細な文法解説",
                            "表現の改善提案",
                            "学習記録"
                        ]
                    },
                    url: "https://gosapo.jp/"
                },
                {
                    name: "Speak",
                    description: "スピーキング特化の学習アプリ",
                    features: ["スピーキング", "AI", "練習"],

                    price: "月額1,980円",
                    logo: "🎤",
                    category: "短い文章と語彙の対策",
                    details: {
                        "学習内容": [
                            "スピーキング練習",
                            "AIとの会話",
                            "発音練習",
                            "語彙学習"
                        ],
                        "特徴": [
                            "AIとの会話練習",
                            "音声認識",
                            "発音評価",
                            "レベル別教材"
                        ]
                    },
                    url: "https://speak.com/"
                },
                {
                    name: "DiaTalk",
                    description: "対話型の英語学習",
                    features: ["対話", "英会話", "練習"],

                    price: "月額3,980円",
                    logo: "💭",
                    category: "短い文章と語彙の対策",
                    details: {
                        "学習内容": [
                            "対話練習",
                            "英会話",
                            "文法練習",
                            "語彙強化"
                        ],
                        "特徴": [
                            "対話型学習",
                            "実践的な内容",
                            "レベル別対応",
                            "進捗管理"
                        ]
                    },
                    url: "https://diatalk.com/"
                },
                {
                    name: "TORAIZ",
                    description: "英作文特化の学習サービス",
                    features: ["英作文", "文法", "添削"],

                    price: "月額4,980円",
                    logo: "📚",
                    category: "短い文章と語彙の対策",
                    details: {
                        "学習内容": [
                            "英作文練習",
                            "文法学習",
                            "添削指導",
                            "語彙強化"
                        ],
                        "特徴": [
                            "英作文特化",
                            "専門添削",
                            "レベル別指導",
                            "成果重視"
                        ]
                    },
                    url: "https://toraiz.com/"
                }
            ],
            advanced: [
                {
                    name: "Cambly",
                    description: "ネイティブ講師との自由な会話で上級者向け",
                    features: ["ネイティブ", "自由会話", "上級者向け"],

                    price: "月額12,000円〜",
                    logo: "🌍",
                    category: "長い文章と表現の対策",
                    details: {
                        "学習内容": [
                            "ネイティブとの自由会話",
                            "ビジネス英語",
                            "専門分野の英語",
                            "文化的な表現"
                        ],
                        "特徴": [
                            "ネイティブ講師のみ",
                            "自由な会話スタイル",
                            "専門分野対応",
                            "文化的な学習"
                        ]
                    },
                    url: "https://www.cambly.com/"
                },
                {
                    name: "Bizmates",
                    description: "ビジネス英語に特化した上級者向けサービス",
                    features: ["ビジネス英語", "上級者向け", "専門コース"],

                    price: "月額15,000円〜",
                    logo: "💼",
                    category: "長い文章と表現の対策",
                    details: {
                        "学習内容": [
                            "ビジネス英語",
                            "プレゼンテーション",
                            "交渉英語",
                            "専門分野英語"
                        ],
                        "特徴": [
                            "ビジネス特化",
                            "実践的な内容",
                            "専門講師",
                            "企業研修対応"
                        ]
                    },
                    url: "https://www.bizmates.jp/"
                },
                {
                    name: "Bizmates Coaching",
                    description: "ビジネス英語の専門コーチング",
                    features: ["コーチング", "ビジネス", "専門"],

                    price: "月額25,000円〜",
                    logo: "🎯",
                    category: "長い文章と表現の対策",
                    details: {
                        "学習内容": [
                            "ビジネス英語コーチング",
                            "プレゼンテーション指導",
                            "交渉スキル",
                            "専門分野英語"
                        ],
                        "特徴": [
                            "専門コーチング",
                            "ビジネス特化",
                            "個人指導",
                            "成果保証"
                        ]
                    },
                    url: "https://www.bizmates.jp/"
                },
                {
                    name: "Cambly Pr",
                    description: "Camblyのプレミアムサービス",
                    features: ["プレミアム", "ネイティブ", "上級者"],

                    price: "月額18,000円〜",
                    logo: "⭐",
                    category: "長い文章と表現の対策",
                    details: {
                        "学習内容": [
                            "プレミアム英会話",
                            "専門分野英語",
                            "文化的学習",
                            "高度な表現"
                        ],
                        "特徴": [
                            "プレミアムサービス",
                            "専門講師",
                            "高度な内容",
                            "個人対応"
                        ]
                    },
                    url: "https://www.cambly.com/"
                },
                {
                    name: "cts コーチング",
                    description: "コミュニケーショントレーニングサポートの専門コーチング",
                    features: ["コーチング", "専門", "個人指導"],

                    price: "月額30,000円〜",
                    logo: "🎓",
                    category: "長い文章と表現の対策",
                    details: {
                        "学習内容": [
                            "専門コーチング",
                            "高度な英語表現",
                            "文化的理解",
                            "実践的なコミュニケーション"
                        ],
                        "特徴": [
                            "専門コーチング",
                            "個人指導",
                            "成果保証",
                            "継続サポート"
                        ]
                    },
                    url: "https://cts-coaching.com/"
                }
            ]
        };
        
        function nextScreen(screenId) {
            document.querySelectorAll('.screen').forEach(screen => {
                screen.classList.remove('active');
            });
            document.getElementById(screenId).classList.add('active');
            
            // レベル結果画面の場合、動的に内容を更新
            if (screenId === 'level-result') {
                updateLevelResult();
            }
            // サービス推奨画面の場合、サービスを表示
            else if (screenId === 'service-recommendation') {
                displayServices();
            }
        }
        
        function prevScreen(screenId) {
            document.querySelectorAll('.screen').forEach(screen => {
                screen.classList.remove('active');
            });
            document.getElementById(screenId).classList.add('active');
        }
        
        function selectDifficulty(element, skill, level) {
            console.log('selectDifficulty called:', skill, level);
            
            // モーダルを閉じる
            closeChallengeModal();
            
            // 既に選択されている場合は選択を解除
            if (element.classList.contains('selected')) {
                element.classList.remove('selected');
                userSelections[skill] = null;
                console.log('Deselected:', skill);
            } else {
                // 同じスキルカテゴリの他のボタンの選択を解除
                const skillGrid = element.closest('.skill-grid');
                const difficultyOptions = element.parentElement;
                const siblings = difficultyOptions.querySelectorAll('.difficulty-btn');
                
                siblings.forEach(sibling => {
                    sibling.classList.remove('selected');
                });
                
                // 新しい選択を追加
                element.classList.add('selected');
                userSelections[skill] = level;
                console.log('Selected:', skill, level);
            }
            
            // 次へボタンの有効/無効を更新
            updateSkillsNextButton();
            
            console.log('Current selections:', userSelections);
        }
        
        function showSolution(type) {
            // タブの切り替え
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // コンテンツの切り替え
            document.getElementById('pronunciation-solution').style.display = 'none';
            document.getElementById('grammar-solution').style.display = 'none';
            
            if (type === 'pronunciation') {
                document.getElementById('pronunciation-solution').style.display = 'block';
            } else {
                document.getElementById('grammar-solution').style.display = 'block';
            }
        }
        
        function displayServices() {
            // 選択された課題に基づいてサービスを決定
            const selectedServices = getFilteredServices();
            
            // レベルに応じたタイトルを更新
            updateRecommendationTitle();
            
            // サービスカードを生成
            const container = document.getElementById('services-container');
            container.innerHTML = '';
            
            if (selectedServices.length === 0) {
                container.innerHTML = '<div style="text-align: center; color: #666; padding: 40px;">課題を選択してからサービスを表示します</div>';
                return;
            }
            
            selectedServices.forEach((service, index) => {
                const card = document.createElement('div');
                card.className = 'service-card';
                card.onclick = () => showServiceDetail(service);
                
                card.innerHTML = `
                    <div class="service-name">${service.name}</div>
                    <div class="service-description">${service.description}</div>
                    <div class="service-features">
                        ${service.features.map(feature => `<span class="feature-tag">${feature}</span>`).join('')}
                    </div>
                `;
                
                container.appendChild(card);
            });
        }
        
        function updateRecommendationTitle() {
            const level = determineUserLevel();
            const levelMap = {
                basic: { level: 'A1', nextLevel: 'A2' },
                intermediate: { level: 'A2', nextLevel: 'B1' },
                advanced: { level: 'B1', nextLevel: 'B2' }
            };
            
            const info = levelMap[level];
            const title = document.getElementById('recommendation-title');
            const subtitle = document.getElementById('recommendation-subtitle');
            
            title.textContent = `${info.level}レベル → ${info.nextLevel}レベルへの学習プラン`;
            
            // 選択された内容に基づいてサブタイトルを更新
            const selectedCategories = [];
            if (userSelections.sound === 'basic') selectedCategories.push('基礎対策');
            if (userSelections.sound === 'intermediate' || userSelections.sound === 'advanced') selectedCategories.push('音の対策');
            if (userSelections.text === 'intermediate' || userSelections.text === 'advanced' || 
                userSelections.vocabulary === 'intermediate' || userSelections.vocabulary === 'advanced') {
                selectedCategories.push('短い文章と語彙の対策');
            }
            if (userSelections.text === 'advanced' || userSelections.vocabulary === 'advanced') {
                selectedCategories.push('長い文章と表現の対策');
            }
            
            if (selectedCategories.length > 0) {
                subtitle.textContent = selectedCategories.join(' ＋ ');
            } else {
                subtitle.textContent = '基礎対策';
            }
        }
        
        function getSelectedServices() {
            const selectedServices = [];
            
            // 選択された内容に基づいてサービスを追加
            if (userSelections.sound === 'basic') {
                selectedServices.push(...services.basic.filter(s => s.category === '基礎対策'));
            } else if (userSelections.sound === 'intermediate') {
                selectedServices.push(...services.sound);
            } else if (userSelections.sound === 'advanced') {
                selectedServices.push(...services.advanced.filter(s => s.category === '長い文章と表現の対策'));
            }
            
            if (userSelections.text === 'basic') {
                selectedServices.push(...services.basic.filter(s => s.category === '基礎対策'));
            } else if (userSelections.text === 'intermediate') {
                selectedServices.push(...services.grammar);
            } else if (userSelections.text === 'advanced') {
                selectedServices.push(...services.advanced.filter(s => s.category === '長い文章と表現の対策'));
            }
            
            if (userSelections.vocabulary === 'basic') {
                selectedServices.push(...services.basic.filter(s => s.category === '基礎対策'));
            } else if (userSelections.vocabulary === 'intermediate') {
                selectedServices.push(...services.grammar);
            } else if (userSelections.vocabulary === 'advanced') {
                selectedServices.push(...services.advanced.filter(s => s.category === '長い文章と表現の対策'));
            }
            
            // 重複を除去
            const uniqueServices = selectedServices.filter((service, index, self) => 
                index === self.findIndex(s => s.name === service.name)
            );
            
            // デフォルトのサービスを追加（選択がない場合）
            if (uniqueServices.length === 0) {
                uniqueServices.push(...services.basic.slice(0, 3));
            }
            
            return uniqueServices;
        }
        
        function determineUserLevel() {
            // 選択されたレベルに基づいて判定
            const levels = Object.values(userSelections).filter(l => l !== null);
            
            if (levels.length === 0) return 'intermediate'; // デフォルト
            
            const basicCount = levels.filter(l => l === 'basic').length;
            const advancedCount = levels.filter(l => l === 'advanced').length;
            const intermediateCount = levels.filter(l => l === 'intermediate').length;
            
            // 最も多いレベルを返す
            if (basicCount >= intermediateCount && basicCount >= advancedCount) return 'basic';
            if (advancedCount >= intermediateCount && advancedCount >= basicCount) return 'advanced';
            return 'intermediate';
        }
        
        function updateLevelResult() {
            // ユーザーのレベルを判定
            const level = determineUserLevel();
            const levelMap = {
                basic: { level: 'A1', description: '基礎から始めるレベル（TOEIC 300-600）' },
                intermediate: { level: 'A2', description: '基礎語彙がある程度理解できるレベル（TOEIC 600-750）' },
                advanced: { level: 'B1', description: '日常会話ができるレベル（TOEIC 750点以上）' }
            };
            
            const info = levelMap[level];
            
            // レベル表示を更新
            document.getElementById('user-level').textContent = info.level;
            document.getElementById('level-description').textContent = info.description;
            
            // ステージタイムラインを更新
            updateStageTimeline(info.level);
            
            // 課題・対策・アプローチのカードを生成
            updateChallengeSolutionCards();
        }
        
        function updateStageTimeline(currentLevel) {
            const stages = ['A1', 'A2', 'B1', 'B2', 'C1', 'C2'];
            const currentIndex = stages.indexOf(currentLevel);
            
            stages.forEach((stage, index) => {
                const stageElement = document.querySelector(`[data-level="${stage}"]`);
                stageElement.classList.remove('passed', 'current');
                
                if (index < currentIndex) {
                    stageElement.classList.add('passed');
                } else if (index === currentIndex) {
                    stageElement.classList.add('current');
                }
            });
        }
        
        function updateSolutionTabs() {
            const tabsContainer = document.getElementById('solution-tabs');
            const contentContainer = document.getElementById('solution-content');
            
            // 選択された内容に基づいてタブを生成
            const tabs = [];
            const contents = {};
            
            if (userSelections.sound === 'intermediate' || userSelections.sound === 'advanced') {
                tabs.push({ id: 'sound', name: '音の対策' });
                contents.sound = [
                    '音を再現できる（発話できる）ことがゴール',
                    '音読/シャドーイング（レベルに合わせた速さ）',
                    '発音矯正トレーニング'
                ];
            }
            
            if (userSelections.text === 'intermediate' || userSelections.text === 'advanced' || 
                userSelections.vocabulary === 'intermediate' || userSelections.vocabulary === 'advanced') {
                tabs.push({ id: 'grammar', name: '短い文章と語彙の対策' });
                contents.grammar = [
                    'とにかく英語の文章をクイックに組むこと',
                    '瞬間英作文、カランメソッドなど、英作文系エクササイズ',
                    '語彙力強化トレーニング'
                ];
            }
            
            if (userSelections.text === 'advanced' || userSelections.vocabulary === 'advanced') {
                tabs.push({ id: 'advanced', name: '長い文章と表現の対策' });
                contents.advanced = [
                    'クイックに構造化すること',
                    '文脈に合わせた表現の選定',
                    '長い文章の多聴多読や、会話でフィードバックを受けることが重要'
                ];
            }
            
            // デフォルトタブを追加（選択がない場合）
            if (tabs.length === 0) {
                tabs.push({ id: 'basic', name: '基礎対策' });
                contents.basic = [
                    '音のルール、文章のルール、基本的な単語など、中学/高校のおさらいが中心',
                    '同時に、自己学習の習慣/経験を積むことが重要'
                ];
            }
            
            // タブを生成
            tabsContainer.innerHTML = tabs.map((tab, index) => 
                `<div class="nav-tab ${index === 0 ? 'active' : ''}" onclick="showSolution('${tab.id}')">${tab.name}</div>`
            ).join('');
            
            // 最初のタブの内容を表示
            const firstTabId = tabs[0].id;
            showSolutionContent(firstTabId, contents[firstTabId]);
        }
        
        function showSolution(tabId) {
            // タブの切り替え
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // 内容を動的に生成
            const contents = {
                sound: [
                    '音を再現できる（発話できる）ことがゴール',
                    '音読/シャドーイング（レベルに合わせた速さ）',
                    '発音矯正トレーニング'
                ],
                grammar: [
                    'とにかく英語の文章をクイックに組むこと',
                    '瞬間英作文、カランメソッドなど、英作文系エクササイズ',
                    '語彙力強化トレーニング'
                ],
                advanced: [
                    'クイックに構造化すること',
                    '文脈に合わせた表現の選定',
                    '長い文章の多聴多読や、会話でフィードバックを受けることが重要'
                ],
                basic: [
                    '音のルール、文章のルール、基本的な単語など、中学/高校のおさらいが中心',
                    '同時に、自己学習の習慣/経験を積むことが重要'
                ]
            };
            
            showSolutionContent(tabId, contents[tabId] || contents.basic);
        }
        
        function showSolutionContent(tabId, contentList) {
            const contentContainer = document.getElementById('solution-content');
            contentContainer.innerHTML = `<ul>${contentList.map(item => `<li>${item}</li>`).join('')}</ul>`;
        }
        
        function updateUserIssues() {
            const issues = [];
            
            if (userSelections.sound === 'basic') {
                issues.push('基本的な音のルールがわからない');
            } else if (userSelections.sound === 'intermediate') {
                issues.push('音が聞き分けられない、音が回らない');
            } else if (userSelections.sound === 'advanced') {
                issues.push('スピードについていけない、長くなると保持できない');
            }
            
            if (userSelections.text === 'basic') {
                issues.push('基本的な文のルール（文法）がわからない');
            } else if (userSelections.text === 'intermediate') {
                issues.push('文章で理解できない、文を組み立てられない');
            } else if (userSelections.text === 'advanced') {
                issues.push('情報量が多くなると理解できない/話せない');
            }
            
            if (userSelections.vocabulary === 'basic') {
                issues.push('基本的な単語がわからない');
            } else if (userSelections.vocabulary === 'intermediate') {
                issues.push('とっさに簡単な単語が出てこない');
            } else if (userSelections.vocabulary === 'advanced') {
                issues.push('文脈に応じた表現の使い分けができない');
            }
            
            // デフォルトの課題を設定
            if (issues.length === 0) {
                issues.push('音が聞き分けられない、音が回らない');
                issues.push('文章で理解できない、文を組み立てられない');
                issues.push('とっさに簡単な単語が出てこない');
            }
            
            const issuesList = document.getElementById('user-issues');
            issuesList.innerHTML = issues.map(issue => `<li>${issue}</li>`).join('');
        }
        
        function updateSkillsNextButton() {
            const nextBtn = document.getElementById('skills-next-btn');
            const hasSkillSelection = userSelections.sound || userSelections.text || userSelections.vocabulary;
            
            console.log('Updating skills next button:', hasSkillSelection);
            
            if (hasSkillSelection) {
                nextBtn.disabled = false;
                nextBtn.style.opacity = '1';
                nextBtn.style.cursor = 'pointer';
                console.log('Next button enabled');
            } else {
                nextBtn.disabled = true;
                nextBtn.style.opacity = '0.5';
                nextBtn.style.cursor = 'not-allowed';
                console.log('Next button disabled');
            }
        }
        
        function showServiceDetail(service) {
            const detailContent = document.getElementById('service-detail-content');
            
            detailContent.innerHTML = `
                <div class="service-header">
                    <div class="service-logo">${service.logo}</div>
                    <div class="service-info">
                        <h2>${service.name}</h2>
                        <div class="service-price">${service.price}</div>
                    </div>
                </div>
                
                <div class="service-details">
                    <div class="detail-section">
                        <h3>学習内容</h3>
                        <ul class="detail-list">
                            ${service.details["学習内容"].map(item => `<li>${item}</li>`).join('')}
                        </ul>
                    </div>
                    <div class="detail-section">
                        <h3>特徴</h3>
                        <ul class="detail-list">
                            ${service.details["特徴"].map(item => `<li>${item}</li>`).join('')}
                        </ul>
                    </div>
                </div>
                
                <div class="cta-section">
                    <h3>このサービスを始める</h3>
                    <p>公式サイトで詳細を確認し、無料体験から始めることをお勧めします。</p>
                </div>
            `;
            
            // 詳細ページに移動
            nextScreen('service-detail');
            
            // URLを保存
            window.currentServiceUrl = service.url;
        }
        
        function visitService() {
            if (window.currentServiceUrl) {
                window.open(window.currentServiceUrl, '_blank');
            }
        }
    </script>
</body>
</html>